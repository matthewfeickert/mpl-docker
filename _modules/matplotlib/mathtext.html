
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>matplotlib.mathtext &#8212; Matplotlib 3.3.0rc1+229.g97785f2e6 documentation</title>
    <link rel="stylesheet" href="../../_static/mpl.css?v3.3.0rc1-229-g97785f2e6" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Matplotlib 3.3.0rc1+229.g97785f2e6 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>

    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<link rel="top" title="Matplotlib 3.3.0rc1+229.g97785f2e6 documentation" href="#" />
    <link rel="canonical" href="https://matplotlib.org/devdocs/_modules/matplotlib/mathtext.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>

<div id="unreleased-message">
    You are reading documentation for the unreleased version of Matplotlib.
    <a href="https://matplotlib.org/search.html?q=matplotlib.mathtext&amp;check_keywords=yes&amp;area=default">
        Try searching for the released version of this page instead?
    </a>
</div>

<!--
<div id="annc-banner">

</div>
-->

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px; position: relative;">
    <a href="../../index.html">
        <div style="float: left; position: absolute; width: 496px; bottom: 0; padding-bottom: 24px"><span style="float: right; color: #789; background: white">Version 3.3.0rc1+229.g97785f2e6</span></div>
        <img src="../../_static/logo2_compressed.svg" height="125px" border="0" alt="matplotlib"/></a>

    <!-- The "Fork me on github" ribbon -->
    <div id="forkongithub"><a href="https://github.com/matplotlib/matplotlib">Fork me on GitHub</a></div>
    </div>

    <nav class="main-nav">
        <ul>
            <li><a href="../../users/installing.html">Installation</a></li>
            <li><a href="../../contents.html">Documentation</a></li>
            <li><a href="../../gallery/index.html">Examples</a></li>
            <li><a href="../../tutorials/index.html">Tutorials</a></li>
            <li><a href="../../devel/index.html">Contributing</a></li>
            <li class="nav-right">
                <form class="search" action="../../search.html" method="get">
                <input type="text" name="q" aria-labelledby="searchlabel" placeholder="Search"/>
                </form>
            </li>
        </ul>
     </nav>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../contents.html">contents</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../matplotlib.html" accesskey="U">matplotlib</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">matplotlib.mathtext</a></li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../contents.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../matplotlib.html">matplotlib</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for matplotlib.mathtext</h1><div class="highlight"><pre>
<span></span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A module for parsing a subset of the TeX math syntax and rendering it to a</span>
<span class="sd">Matplotlib backend.</span>

<span class="sd">For a tutorial of its usage, see :doc:`/tutorials/text/mathtext`.  This</span>
<span class="sd">document is primarily concerned with implementation details.</span>

<span class="sd">The module uses pyparsing_ to parse the TeX expression.</span>

<span class="sd">.. _pyparsing: https://pypi.org/project/pyparsing/</span>

<span class="sd">The Bakoma distribution of the TeX Computer Modern fonts, and STIX</span>
<span class="sd">fonts are supported.  There is experimental support for using</span>
<span class="sd">arbitrary fonts, but results may vary without proper tweaking and</span>
<span class="sd">metrics for those fonts.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">unicodedata</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">pyparsing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Combine</span><span class="p">,</span> <span class="n">Empty</span><span class="p">,</span> <span class="n">FollowedBy</span><span class="p">,</span> <span class="n">Forward</span><span class="p">,</span> <span class="n">Group</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">oneOf</span><span class="p">,</span> <span class="n">OneOrMore</span><span class="p">,</span>
    <span class="n">Optional</span><span class="p">,</span> <span class="n">ParseBaseException</span><span class="p">,</span> <span class="n">ParseFatalException</span><span class="p">,</span> <span class="n">ParserElement</span><span class="p">,</span>
    <span class="n">QuotedString</span><span class="p">,</span> <span class="n">Regex</span><span class="p">,</span> <span class="n">StringEnd</span><span class="p">,</span> <span class="n">Suppress</span><span class="p">,</span> <span class="n">ZeroOrMore</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">colors</span> <span class="k">as</span> <span class="n">mcolors</span><span class="p">,</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">matplotlib.afm</span> <span class="kn">import</span> <span class="n">AFM</span>
<span class="kn">from</span> <span class="nn">matplotlib.ft2font</span> <span class="kn">import</span> <span class="n">FT2Image</span><span class="p">,</span> <span class="n">KERNING_DEFAULT</span><span class="p">,</span> <span class="n">LOAD_NO_HINTING</span>
<span class="kn">from</span> <span class="nn">matplotlib.font_manager</span> <span class="kn">import</span> <span class="n">findfont</span><span class="p">,</span> <span class="n">FontProperties</span><span class="p">,</span> <span class="n">get_font</span>
<span class="kn">from</span> <span class="nn">matplotlib._mathtext_data</span> <span class="kn">import</span> <span class="p">(</span><span class="n">latex_to_bakoma</span><span class="p">,</span> <span class="n">latex_to_standard</span><span class="p">,</span>
                                       <span class="n">tex2uni</span><span class="p">,</span> <span class="n">latex_to_cmex</span><span class="p">,</span>
                                       <span class="n">stix_virtual_fonts</span><span class="p">)</span>

<span class="n">ParserElement</span><span class="o">.</span><span class="n">enablePackrat</span><span class="p">()</span>
<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1">##############################################################################</span>
<span class="c1"># FONTS</span>

<div class="viewcode-block" id="get_unicode_index"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.get_unicode_index">[docs]</a><span class="k">def</span> <span class="nf">get_unicode_index</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the integer index (from the Unicode table) of *symbol*.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    symbol : str</span>
<span class="sd">        A single unicode character, a TeX command (e.g. r&#39;\pi&#39;) or a Type1</span>
<span class="sd">        symbol name (e.g. &#39;phi&#39;).</span>
<span class="sd">    math : bool, default: True</span>
<span class="sd">        If False, always treat as a single unicode character.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># for a non-math symbol, simply return its unicode index</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="c1"># From UTF #25: U+2212 minus sign is the preferred</span>
    <span class="c1"># representation of the unary and binary minus sign rather than</span>
    <span class="c1"># the ASCII-derived U+002D hyphen-minus, because minus sign is</span>
    <span class="c1"># unambiguous and because it is rendered with a more desirable</span>
    <span class="c1"># length, usually longer than a hyphen.</span>
    <span class="k">if</span> <span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mh">0x2212</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># This will succeed if symbol is a single unicode char</span>
        <span class="k">return</span> <span class="nb">ord</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># Is symbol a TeX symbol (i.e. \alpha)</span>
        <span class="k">return</span> <span class="n">tex2uni</span><span class="p">[</span><span class="n">symbol</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; is not a valid Unicode character or TeX/Type1 symbol&quot;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">symbol</span><span class="p">))</span> <span class="kn">from</span> <span class="nn">err</span></div>


<div class="viewcode-block" id="MathtextBackend"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackend</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The base class for the mathtext backend-specific code.  `MathtextBackend`</span>
<span class="sd">    subclasses interface between mathtext and specific Matplotlib graphics</span>
<span class="sd">    backends.</span>

<span class="sd">    Subclasses need to override the following:</span>

<span class="sd">    - :meth:`render_glyph`</span>
<span class="sd">    - :meth:`render_rect_filled`</span>
<span class="sd">    - :meth:`get_results`</span>

<span class="sd">    And optionally, if you need to use a FreeType hinting style:</span>

<span class="sd">    - :meth:`get_hinting_type`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="MathtextBackend.set_canvas_size"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.set_canvas_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the dimension of the drawing canvas.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">=</span> <span class="n">w</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">=</span> <span class="n">d</span></div>

<div class="viewcode-block" id="MathtextBackend.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a glyph described by *info* to the reference point (*ox*,</span>
<span class="sd">        *oy*).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="MathtextBackend.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a filled black rectangle from (*x1*, *y1*) to (*x2*, *y2*).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="MathtextBackend.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a backend-specific tuple to return to the backend after</span>
<span class="sd">        all processing is done.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="MathtextBackend.get_hinting_type"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackend.get_hinting_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_hinting_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the FreeType hinting type to use with this particular</span>
<span class="sd">        backend.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">LOAD_NO_HINTING</span></div></div>


<div class="viewcode-block" id="MathtextBackendAgg"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendAgg</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Render glyphs and rectangles to an FTImage buffer, which is later</span>
<span class="sd">    transferred to the Agg image by the Agg backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ox</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oy</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;bbox&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">MathtextBackend</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x1</span><span class="p">),</span>
                     <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y1</span><span class="p">),</span>
                     <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x2</span><span class="p">),</span>
                     <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">y2</span><span class="p">)]</span>

<div class="viewcode-block" id="MathtextBackendAgg.set_canvas_size"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.set_canvas_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">MathtextBackend</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s1">&#39;bbox&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">FT2Image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;bbox&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_bbox</span><span class="p">(</span><span class="n">ox</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span>
                              <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span>
                              <span class="n">ox</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
                              <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">draw_glyph_to_bitmap</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">glyph</span><span class="p">,</span>
                <span class="n">antialiased</span><span class="o">=</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.antialiased&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;bbox&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_bbox</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">height</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span> <span class="o">+</span> <span class="n">y1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">center</span> <span class="o">-</span> <span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">draw_rect_filled</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y</span> <span class="o">+</span> <span class="n">height</span><span class="p">)</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;bbox&#39;</span>
        <span class="n">orig_height</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">orig_depth</span>  <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">depth</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;render&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span>
            <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">orig_depth</span><span class="p">,</span>
            <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">orig_height</span><span class="p">)</span>
        <span class="n">ship</span><span class="p">(</span><span class="o">-</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">box</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ox</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">oy</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span>
                  <span class="n">used_characters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="MathtextBackendAgg.get_hinting_type"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendAgg.get_hinting_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_hinting_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">matplotlib.backends</span> <span class="kn">import</span> <span class="n">backend_agg</span>
        <span class="k">return</span> <span class="n">backend_agg</span><span class="o">.</span><span class="n">get_hinting_flag</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="MathtextBackendBitmap"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendBitmap">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendBitmap</span><span class="p">(</span><span class="n">MathtextBackendAgg</span><span class="p">):</span>
<div class="viewcode-block" id="MathtextBackendBitmap.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendBitmap.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">characters</span> <span class="o">=</span> \
            <span class="n">MathtextBackendAgg</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">depth</span></div></div>


<div class="viewcode-block" id="MathtextBackendPs"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendPs</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store information to write a mathtext rendering to the PostScript backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_PSResult</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
        <span class="s2">&quot;_PSResult&quot;</span><span class="p">,</span> <span class="s2">&quot;width height depth pswriter used_characters&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastfont</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MathtextBackendPs.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">postscript_name</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">postscript_name</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">postscript_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastfont</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastfont</span> <span class="o">=</span> <span class="n">postscript_name</span><span class="p">,</span> <span class="n">fontsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">postscript_name</span><span class="si">}</span><span class="s2"> findfont</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fontsize</span><span class="si">}</span><span class="s2"> scalefont</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;setfont</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ox</span><span class="si">:</span><span class="s2">f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">oy</span><span class="si">:</span><span class="s2">f</span><span class="si">}</span><span class="s2"> moveto</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">info</span><span class="o">.</span><span class="n">symbol_name</span><span class="si">}</span><span class="s2"> glyphshow</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="MathtextBackendPs.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> </span><span class="si">%f</span><span class="s2"> rectfill</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span></div>

<div class="viewcode-block" id="MathtextBackendPs.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPs.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PSResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span><span class="p">,</span>
                              <span class="n">used_characters</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MathtextBackendPdf"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendPdf</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Store information to write a mathtext rendering to the PDF backend.&quot;&quot;&quot;</span>

    <span class="n">_PDFResult</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
        <span class="s2">&quot;_PDFResult&quot;</span><span class="p">,</span> <span class="s2">&quot;width height depth glyphs rects used_characters&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendPdf.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
             <span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">symbol_name</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPdf.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPdf.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPdf.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PDFResult</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="p">,</span>
                               <span class="n">used_characters</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MathtextBackendSvg"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendSvg</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store information to write a mathtext rendering to the SVG</span>
<span class="sd">    backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg_glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg_rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendSvg.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">svg_glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendSvg.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svg_rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendSvg.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendSvg.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="n">svg_elements</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">svg_glyphs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">svg_glyphs</span><span class="p">,</span>
                                             <span class="n">svg_rects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">svg_rects</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="n">svg_elements</span><span class="p">,</span>
                <span class="n">used_characters</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MathtextBackendPath"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendPath</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store information to write a mathtext rendering to the text path</span>
<span class="sd">    machinery.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendPath.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span>
        <span class="n">thetext</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">num</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">thetext</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPath.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">y2</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendPath.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendPath.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MathtextBackendCairo"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo">[docs]</a><span class="k">class</span> <span class="nc">MathtextBackendCairo</span><span class="p">(</span><span class="n">MathtextBackend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Store information to write a mathtext rendering to the Cairo</span>
<span class="sd">    backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="MathtextBackendCairo.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">oy</span> <span class="o">=</span> <span class="n">oy</span> <span class="o">-</span> <span class="n">info</span><span class="o">.</span><span class="n">offset</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="n">thetext</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">info</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">thetext</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendCairo.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">))</span></div>

<div class="viewcode-block" id="MathtextBackendCairo.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathtextBackendCairo.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">used_characters</span><span class="p">):</span>
        <span class="n">ship</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">glyphs</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rects</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Fonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts">[docs]</a><span class="k">class</span> <span class="nc">Fonts</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract base class for a system of fonts to use for mathtext.</span>

<span class="sd">    The class must be able to take symbol keys and font file names and</span>
<span class="sd">    return the character metrics.  It also delegates to a backend class</span>
<span class="sd">    to do the actual drawing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">mathtext_backend</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        default_font_prop: `~.font_manager.FontProperties`</span>
<span class="sd">            The default non-math font, or the base font for Unicode (generic)</span>
<span class="sd">            font rendering.</span>
<span class="sd">        mathtext_backend: `MathtextBackend` subclass</span>
<span class="sd">            Backend to which rendering is actually delegated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_font_prop</span> <span class="o">=</span> <span class="n">default_font_prop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span> <span class="o">=</span> <span class="n">mathtext_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Fonts.destroy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fix any cyclical references before the object is about</span>
<span class="sd">        to be destroyed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Fonts.get_kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_kern">[docs]</a>    <span class="k">def</span> <span class="nf">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                 <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the kerning distance for font between *sym1* and *sym2*.</span>

<span class="sd">        *fontX*: one of the TeX font names::</span>

<span class="sd">          tt, it, rm, cal, sf, bf or default/regular (non-math)</span>

<span class="sd">        *fontclassX*: TODO</span>

<span class="sd">        *symX*: a symbol in raw TeX form. e.g., &#39;1&#39;, &#39;x&#39; or &#39;\sigma&#39;</span>

<span class="sd">        *fontsizeX*: the fontsize in points</span>

<span class="sd">        *dpi*: the current dots-per-inch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">0.</span></div>

<div class="viewcode-block" id="Fonts.get_metrics"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_metrics">[docs]</a>    <span class="k">def</span> <span class="nf">get_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        *font*: one of the TeX font names::</span>

<span class="sd">          tt, it, rm, cal, sf, bf or default/regular (non-math)</span>

<span class="sd">        *font_class*: TODO</span>

<span class="sd">        *sym*:  a symbol in raw TeX form. e.g., &#39;1&#39;, &#39;x&#39; or &#39;\sigma&#39;</span>

<span class="sd">        *fontsize*: font size in points</span>

<span class="sd">        *dpi*: current dots-per-inch</span>

<span class="sd">        *math*: whether sym is a math character</span>

<span class="sd">        Returns an object with the following attributes:</span>

<span class="sd">        - *advance*: The advance distance (in points) of the glyph.</span>

<span class="sd">        - *height*: The height of the glyph in points.</span>

<span class="sd">        - *width*: The width of the glyph in points.</span>

<span class="sd">        - *xmin*, *xmax*, *ymin*, *ymax* - the ink rectangle of the glyph</span>

<span class="sd">        - *iceberg* - the distance from the baseline to the top of</span>
<span class="sd">          the glyph.  This corresponds to TeX&#39;s definition of &quot;height&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">info</span><span class="o">.</span><span class="n">metrics</span></div>

<div class="viewcode-block" id="Fonts.set_canvas_size"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.set_canvas_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_canvas_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the size of the buffer used to render the math expression.</span>
<span class="sd">        Only really necessary for the bitmap backends.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">([</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fonts.render_glyph"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.render_glyph">[docs]</a>    <span class="k">def</span> <span class="nf">render_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">facename</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a glyph at</span>

<span class="sd">          - *ox*, *oy*: position</span>

<span class="sd">          - *facename*: One of the TeX face names</span>

<span class="sd">          - *font_class*:</span>

<span class="sd">          - *sym*: TeX symbol name or single character</span>

<span class="sd">          - *fontsize*: fontsize in points</span>

<span class="sd">          - *dpi*: The dpi to draw at.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">facename</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">render_glyph</span><span class="p">(</span><span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fonts.render_rect_filled"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.render_rect_filled">[docs]</a>    <span class="k">def</span> <span class="nf">render_rect_filled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a filled rectangle from (*x1*, *y1*) to (*x2*, *y2*).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">render_rect_filled</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fonts.get_xheight"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_xheight">[docs]</a>    <span class="k">def</span> <span class="nf">get_xheight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the xheight for the given *font* and *fontsize*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Fonts.get_underline_thickness"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_underline_thickness">[docs]</a>    <span class="k">def</span> <span class="nf">get_underline_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the line thickness that matches the given font.  Used as a</span>
<span class="sd">        base unit for drawing lines such as in a fraction or radical.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="Fonts.get_used_characters"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_used_characters">[docs]</a>    <span class="k">def</span> <span class="nf">get_used_characters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the set of characters that were used in the math</span>
<span class="sd">        expression.  Used by backends that need to subset fonts so</span>
<span class="sd">        they know which glyphs to include.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">used_characters</span></div>

<div class="viewcode-block" id="Fonts.get_results"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_results">[docs]</a>    <span class="k">def</span> <span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the data needed by the backend to render the math</span>
<span class="sd">        expression.  The return value is backend-specific.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span>
            <span class="n">box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_used_characters</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Fonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override if your font provides multiple sizes of the same</span>
<span class="sd">        symbol.  Should return a list of symbols matching *sym* in</span>
<span class="sd">        various sizes.  The expression renderer will select the most</span>
<span class="sd">        appropriate size for a given situation from this list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)]</span></div></div>


<div class="viewcode-block" id="TruetypeFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts">[docs]</a><span class="k">class</span> <span class="nc">TruetypeFonts</span><span class="p">(</span><span class="n">Fonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A generic base class for all font setups that use Truetype fonts</span>
<span class="sd">    (through FT2Font).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">mathtext_backend</span><span class="p">):</span>
        <span class="n">Fonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">mathtext_backend</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">default_font_prop</span><span class="p">)</span>
        <span class="n">default_font</span> <span class="o">=</span> <span class="n">get_font</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>

<div class="viewcode-block" id="TruetypeFonts.destroy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Fonts</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">font</span>
        <span class="n">cached_font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_font</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">basename</span><span class="p">):</span>
            <span class="n">cached_font</span> <span class="o">=</span> <span class="n">get_font</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="n">basename</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="n">cached_font</span><span class="o">.</span><span class="n">postscript_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fonts</span><span class="p">[</span><span class="n">cached_font</span><span class="o">.</span><span class="n">postscript_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">cached_font</span>
        <span class="k">return</span> <span class="n">cached_font</span>

    <span class="k">def</span> <span class="nf">_get_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font</span><span class="o">.</span><span class="n">postscript_name</span> <span class="o">==</span> <span class="s1">&#39;Cmex10&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">glyph</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">64</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">fontsize</span><span class="o">/</span><span class="mi">3</span> <span class="o">*</span> <span class="n">dpi</span><span class="o">/</span><span class="mi">72</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.</span>

    <span class="k">def</span> <span class="nf">_get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span>
        <span class="n">bunch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bunch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">bunch</span>

        <span class="n">font</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">slanted</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>

        <span class="n">font</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">glyph</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">load_char</span><span class="p">(</span>
            <span class="n">num</span><span class="p">,</span>
            <span class="n">flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mathtext_backend</span><span class="o">.</span><span class="n">get_hinting_type</span><span class="p">())</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="o">/</span><span class="mf">64.0</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">glyph</span><span class="o">.</span><span class="n">bbox</span><span class="p">]</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_offset</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">glyph</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">(</span>
            <span class="n">advance</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">linearHoriAdvance</span><span class="o">/</span><span class="mf">65536.0</span><span class="p">,</span>
            <span class="n">height</span>  <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">height</span><span class="o">/</span><span class="mf">64.0</span><span class="p">,</span>
            <span class="n">width</span>   <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">width</span><span class="o">/</span><span class="mf">64.0</span><span class="p">,</span>
            <span class="n">xmin</span>    <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
            <span class="n">xmax</span>    <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
            <span class="n">ymin</span>    <span class="o">=</span> <span class="n">ymin</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="n">ymax</span>    <span class="o">=</span> <span class="n">ymax</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="c1"># iceberg is the equivalent of TeX&#39;s &quot;height&quot;</span>
            <span class="n">iceberg</span> <span class="o">=</span> <span class="n">glyph</span><span class="o">.</span><span class="n">horiBearingY</span><span class="o">/</span><span class="mf">64.0</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="n">slanted</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">(</span>
            <span class="n">font</span>            <span class="o">=</span> <span class="n">font</span><span class="p">,</span>
            <span class="n">fontsize</span>        <span class="o">=</span> <span class="n">fontsize</span><span class="p">,</span>
            <span class="n">postscript_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">postscript_name</span><span class="p">,</span>
            <span class="n">metrics</span>         <span class="o">=</span> <span class="n">metrics</span><span class="p">,</span>
            <span class="n">symbol_name</span>     <span class="o">=</span> <span class="n">symbol_name</span><span class="p">,</span>
            <span class="n">num</span>             <span class="o">=</span> <span class="n">num</span><span class="p">,</span>
            <span class="n">glyph</span>           <span class="o">=</span> <span class="n">glyph</span><span class="p">,</span>
            <span class="n">offset</span>          <span class="o">=</span> <span class="n">offset</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="TruetypeFonts.get_xheight"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.get_xheight">[docs]</a>    <span class="k">def</span> <span class="nf">get_xheight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
        <span class="n">font</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">pclt</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_sfnt_table</span><span class="p">(</span><span class="s1">&#39;pclt&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pclt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Some fonts don&#39;t store the xHeight, so we do a poor man&#39;s xHeight</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
                <span class="n">fontname</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.default&#39;</span><span class="p">],</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span>
        <span class="n">xHeight</span> <span class="o">=</span> <span class="p">(</span><span class="n">pclt</span><span class="p">[</span><span class="s1">&#39;xHeight&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">64.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">fontsize</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dpi</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xHeight</span></div>

<div class="viewcode-block" id="TruetypeFonts.get_underline_thickness"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.get_underline_thickness">[docs]</a>    <span class="k">def</span> <span class="nf">get_underline_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="c1"># This function used to grab underline thickness from the font</span>
        <span class="c1"># metrics, but that information is just too un-reliable, so it</span>
        <span class="c1"># is now hardcoded.</span>
        <span class="k">return</span> <span class="p">((</span><span class="mf">0.75</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">fontsize</span> <span class="o">*</span> <span class="n">dpi</span><span class="p">)</span> <span class="o">/</span> <span class="mf">72.0</span></div>

<div class="viewcode-block" id="TruetypeFonts.get_kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.TruetypeFonts.get_kern">[docs]</a>    <span class="k">def</span> <span class="nf">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                 <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font1</span> <span class="o">==</span> <span class="n">font2</span> <span class="ow">and</span> <span class="n">fontsize1</span> <span class="o">==</span> <span class="n">fontsize2</span><span class="p">:</span>
            <span class="n">info1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">info2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">info1</span><span class="o">.</span><span class="n">font</span>
            <span class="k">return</span> <span class="n">font</span><span class="o">.</span><span class="n">get_kerning</span><span class="p">(</span><span class="n">info1</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">info2</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="n">KERNING_DEFAULT</span><span class="p">)</span> <span class="o">/</span> <span class="mi">64</span>
        <span class="k">return</span> <span class="n">Fonts</span><span class="o">.</span><span class="n">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                              <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BakomaFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.BakomaFonts">[docs]</a><span class="k">class</span> <span class="nc">BakomaFonts</span><span class="p">(</span><span class="n">TruetypeFonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the Bakoma TrueType fonts for rendering.</span>

<span class="sd">    Symbols are strewn about a number of font files, each of which has</span>
<span class="sd">    its own proprietary 8-bit encoding.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cal&#39;</span><span class="p">:</span> <span class="s1">&#39;cmsy10&#39;</span><span class="p">,</span>
        <span class="s1">&#39;rm&#39;</span><span class="p">:</span>  <span class="s1">&#39;cmr10&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tt&#39;</span><span class="p">:</span>  <span class="s1">&#39;cmtt10&#39;</span><span class="p">,</span>
        <span class="s1">&#39;it&#39;</span><span class="p">:</span>  <span class="s1">&#39;cmmi10&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bf&#39;</span><span class="p">:</span>  <span class="s1">&#39;cmb10&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sf&#39;</span><span class="p">:</span>  <span class="s1">&#39;cmss10&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ex&#39;</span><span class="p">:</span>  <span class="s1">&#39;cmex10&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stix_fallback</span> <span class="o">=</span> <span class="n">StixFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>

    <span class="n">_slanted_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\int \oint&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_get_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">symbol_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">font</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">fontname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="ow">and</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">latex_to_bakoma</span><span class="p">:</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">latex_to_bakoma</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">basename</span> <span class="o">==</span> <span class="s2">&quot;cmmi10&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slanted_symbols</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">fontname</span> <span class="o">==</span> <span class="s2">&quot;it&quot;</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gid</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gid</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_glyph_name</span><span class="p">(</span><span class="n">gid</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">symbol_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stix_fallback</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span>
                <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">font</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">slanted</span>

    <span class="c1"># The Bakoma fonts contain many pre-sized alternatives for the</span>
    <span class="c1"># delimiters.  The AutoSizedChar class will use these alternatives</span>
    <span class="c1"># and select the best (closest sized) glyph.</span>
    <span class="n">_size_alternatives</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;(&#39;</span><span class="p">:</span>           <span class="p">[(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa1</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xb3</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xb5</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xc3</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;)&#39;</span><span class="p">:</span>           <span class="p">[(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa2</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xb4</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xb6</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x21</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;{&#39;</span><span class="p">:</span>           <span class="p">[(</span><span class="s1">&#39;cal&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa9</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x6e</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xbd</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x28</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;}&#39;</span><span class="p">:</span>           <span class="p">[(</span><span class="s1">&#39;cal&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xaa</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x6f</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xbe</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x29</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="c1"># The fourth size of &#39;[&#39; is mysteriously missing from the BaKoMa</span>
        <span class="c1"># font, so I&#39;ve omitted it for both &#39;[&#39; and &#39;]&#39;</span>
        <span class="s1">&#39;[&#39;</span><span class="p">:</span>           <span class="p">[(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa3</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x68</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x22</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="s1">&#39;]&#39;</span><span class="p">:</span>           <span class="p">[(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa4</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x69</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x23</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\lfloor&#39;</span><span class="p">:</span>    <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa5</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x6a</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xb9</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x24</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\rfloor&#39;</span><span class="p">:</span>    <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa6</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x6b</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xba</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x25</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\lceil&#39;</span><span class="p">:</span>     <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa7</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x6c</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xbb</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x26</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\rceil&#39;</span><span class="p">:</span>     <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xa8</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x6d</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xbc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x27</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\langle&#39;</span><span class="p">:</span>    <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xad</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x44</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xbf</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x2a</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\rangle&#39;</span><span class="p">:</span>    <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xae</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x45</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xc0</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x2b</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\__sqrt__&#39;</span><span class="p">:</span>  <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x70</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x71</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x72</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x73</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\backslash&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xb2</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x2f</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xc2</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x2d</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;/&#39;</span><span class="p">:</span>          <span class="p">[(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xb1</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x2e</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\xcb</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x2c</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\widehat&#39;</span><span class="p">:</span>   <span class="p">[(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x5e</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x62</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x63</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x64</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;\widetilde&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x7e</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x65</span><span class="s1">&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x66</span><span class="s1">&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x67</span><span class="s1">&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>          <span class="p">[(</span><span class="s1">&#39;cal&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">)],</span>
        <span class="sa">r</span><span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>          <span class="p">[(</span><span class="s1">&#39;cal&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">)]</span>
        <span class="p">}</span>

    <span class="k">for</span> <span class="n">alias</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="p">[(</span><span class="sa">r</span><span class="s1">&#39;\leftparen&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\rightparent&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\leftbrace&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\rightbrace&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\leftbracket&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\rightbracket&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\{&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\[&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">),</span>
                          <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\]&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">)]:</span>
        <span class="n">_size_alternatives</span><span class="p">[</span><span class="n">alias</span><span class="p">]</span> <span class="o">=</span> <span class="n">_size_alternatives</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>

<div class="viewcode-block" id="BakomaFonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.BakomaFonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size_alternatives</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)])</span></div></div>


<div class="viewcode-block" id="UnicodeFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.UnicodeFonts">[docs]</a><span class="k">class</span> <span class="nc">UnicodeFonts</span><span class="p">(</span><span class="n">TruetypeFonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract base class for handling Unicode fonts.</span>

<span class="sd">    While some reasonably complete Unicode fonts (such as DejaVu) may</span>
<span class="sd">    work in some situations, the only Unicode font I&#39;m aware of with a</span>
<span class="sd">    complete set of math symbols is STIX.</span>

<span class="sd">    This class will &quot;fallback&quot; on the Bakoma fonts when a required</span>
<span class="sd">    symbol can not be found in the font.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">use_cmex</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># This must come first so the backend&#39;s owner is set correctly</span>
        <span class="n">fallback_rc</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fallback&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fallback_to_cm&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fallback_rc</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;cm&#39;</span> <span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fallback_to_cm&#39;</span><span class="p">]</span>
                           <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">font_class</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;stix&#39;</span><span class="p">:</span> <span class="n">StixFonts</span><span class="p">,</span>
                      <span class="s1">&#39;stixsans&#39;</span><span class="p">:</span> <span class="n">StixSansFonts</span><span class="p">,</span>
                      <span class="s1">&#39;cm&#39;</span><span class="p">:</span> <span class="n">BakomaFonts</span>
                      <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fallback_rc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span> <span class="o">=</span> <span class="n">font_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">if</span> <span class="n">font_class</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">texfont</span> <span class="ow">in</span> <span class="s2">&quot;cal rm tt it bf sf&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.&#39;</span> <span class="o">+</span> <span class="n">texfont</span><span class="p">]</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">texfont</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="s1">&#39;cmex10&#39;</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="s1">&#39;ex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>

        <span class="c1"># include STIX sized alternatives for glyphs if fallback is STIX</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">,</span> <span class="n">StixFonts</span><span class="p">):</span>
            <span class="n">stixsizedaltfonts</span> <span class="o">=</span> <span class="p">{</span>
                 <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;STIXGeneral&#39;</span><span class="p">,</span>
                 <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;STIXSizeOneSym&#39;</span><span class="p">,</span>
                 <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;STIXSizeTwoSym&#39;</span><span class="p">,</span>
                 <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;STIXSizeThreeSym&#39;</span><span class="p">,</span>
                 <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;STIXSizeFourSym&#39;</span><span class="p">,</span>
                 <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;STIXSizeFiveSym&#39;</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">size</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">stixsizedaltfonts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">fullpath</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>

    <span class="n">_slanted_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\int \oint&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_map_virtual_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">uniindex</span>

    <span class="k">def</span> <span class="nf">_get_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_cmex</span><span class="p">:</span>
            <span class="n">uniindex</span> <span class="o">=</span> <span class="n">latex_to_cmex</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">uniindex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="s1">&#39;ex&#39;</span>
                <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="n">get_unicode_index</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
                <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No TeX to unicode mapping for </span><span class="si">{!a}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span>

        <span class="n">fontname</span><span class="p">,</span> <span class="n">uniindex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_virtual_font</span><span class="p">(</span>
            <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">)</span>

        <span class="n">new_fontname</span> <span class="o">=</span> <span class="n">fontname</span>

        <span class="c1"># Only characters in the &quot;Letter&quot; class should be italicized in &#39;it&#39;</span>
        <span class="c1"># mode.  Greek capital letters should be Roman.</span>
        <span class="k">if</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fontname</span> <span class="o">==</span> <span class="s1">&#39;it&#39;</span> <span class="ow">and</span> <span class="n">uniindex</span> <span class="o">&lt;</span> <span class="mh">0x10000</span><span class="p">:</span>
                <span class="n">char</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">char</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;L&quot;</span>
                        <span class="ow">or</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">char</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;GREEK CAPITAL&quot;</span><span class="p">)):</span>
                    <span class="n">new_fontname</span> <span class="o">=</span> <span class="s1">&#39;rm&#39;</span>

            <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_fontname</span> <span class="o">==</span> <span class="s1">&#39;it&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slanted_symbols</span>
            <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">new_fontname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">glyphindex</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glyphindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fontname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;regular&#39;</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">,</span> <span class="n">StixFonts</span><span class="p">)):</span>
                    <span class="n">fontname</span> <span class="o">=</span> <span class="s1">&#39;rm&#39;</span>

                <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span>
                                                <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">)</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">family_name</span>
                <span class="k">if</span> <span class="n">fname</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">BakomaFonts</span><span class="o">.</span><span class="n">_fontmap</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">fname</span> <span class="o">=</span> <span class="s2">&quot;Computer Modern&quot;</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Substituting symbol </span><span class="si">{}</span><span class="s2"> &quot;</span>
                             <span class="s2">&quot;from </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">g</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">fontname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;regular&#39;</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">StixFonts</span><span class="p">)):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">)</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Font </span><span class="si">{!r}</span><span class="s2"> does not have a glyph for </span><span class="si">{!a}</span><span class="s2"> &quot;</span>
                             <span class="s2">&quot;[U+</span><span class="si">{:x}</span><span class="s2">], substituting with a dummy &quot;</span>
                             <span class="s2">&quot;symbol.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">))</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="s1">&#39;rm&#39;</span>
                <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="mh">0xA4</span>  <span class="c1"># currency char, for lack of anything better</span>
                <span class="n">glyphindex</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                <span class="n">slanted</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_glyph_name</span><span class="p">(</span><span class="n">glyphindex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">font</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">,</span> <span class="n">symbol_name</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">slanted</span>

<div class="viewcode-block" id="UnicodeFonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.UnicodeFonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span><span class="o">.</span><span class="n">get_sized_alternatives_for_symbol</span><span class="p">(</span>
                <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)]</span></div></div>


<div class="viewcode-block" id="DejaVuFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuFonts">[docs]</a><span class="k">class</span> <span class="nc">DejaVuFonts</span><span class="p">(</span><span class="n">UnicodeFonts</span><span class="p">):</span>
    <span class="n">use_cmex</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># This must come first so the backend&#39;s owner is set correctly</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DejaVuSerifFonts</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span> <span class="o">=</span> <span class="n">StixFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cm_fallback</span> <span class="o">=</span> <span class="n">StixSansFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bakoma</span> <span class="o">=</span> <span class="n">BakomaFonts</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Include Stix sized alternatives for glyphs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;STIXSizeOneSym&#39;</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;STIXSizeTwoSym&#39;</span><span class="p">,</span>
            <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;STIXSizeThreeSym&#39;</span><span class="p">,</span>
            <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;STIXSizeFourSym&#39;</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;STIXSizeFiveSym&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>

    <span class="k">def</span> <span class="nf">_get_glyph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># Override prime symbol to use Bakoma.</span>
        <span class="k">if</span> <span class="n">sym</span> <span class="o">==</span> <span class="sa">r</span><span class="s1">&#39;\prime&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bakoma</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span>
                <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># check whether the glyph is available in the display font</span>
            <span class="n">uniindex</span> <span class="o">=</span> <span class="n">get_unicode_index</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="s1">&#39;ex&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">glyphindex</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">glyphindex</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span>
                        <span class="s1">&#39;ex&#39;</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span>
            <span class="c1"># otherwise return regular glyph</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_get_glyph</span><span class="p">(</span>
                <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">math</span><span class="p">)</span></div>


<div class="viewcode-block" id="DejaVuSerifFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSerifFonts">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSerifFonts</span><span class="p">(</span><span class="n">DejaVuFonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A font handling class for the DejaVu Serif fonts</span>

<span class="sd">    If a glyph is not found it will fallback to Stix Serif</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rm&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Serif&#39;</span><span class="p">,</span>
        <span class="s1">&#39;it&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Serif:italic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bf&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Serif:weight=bold&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sf&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tt&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans Mono&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ex&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Serif Display&#39;</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span>    <span class="s1">&#39;DejaVu Serif&#39;</span><span class="p">,</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="DejaVuSansFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSansFonts">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSansFonts</span><span class="p">(</span><span class="n">DejaVuFonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A font handling class for the DejaVu Sans fonts</span>

<span class="sd">    If a glyph is not found it will fallback to Stix Sans</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rm&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;it&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans:italic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bf&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans:weight=bold&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sf&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tt&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans Mono&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ex&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans Display&#39;</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span>    <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">,</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="StixFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StixFonts">[docs]</a><span class="k">class</span> <span class="nc">StixFonts</span><span class="p">(</span><span class="n">UnicodeFonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A font handling class for the STIX fonts.</span>

<span class="sd">    In addition to what UnicodeFonts provides, this class:</span>

<span class="sd">    - supports &quot;virtual fonts&quot; which are complete alpha numeric</span>
<span class="sd">      character sets with different font styles at special Unicode</span>
<span class="sd">      code points, such as &quot;Blackboard&quot;.</span>

<span class="sd">    - handles sized alternative characters for the STIXSizeX fonts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_fontmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;rm&#39;</span><span class="p">:</span> <span class="s1">&#39;STIXGeneral&#39;</span><span class="p">,</span>
        <span class="s1">&#39;it&#39;</span><span class="p">:</span> <span class="s1">&#39;STIXGeneral:italic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bf&#39;</span><span class="p">:</span> <span class="s1">&#39;STIXGeneral:weight=bold&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nonunirm&#39;</span><span class="p">:</span> <span class="s1">&#39;STIXNonUnicode&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nonuniit&#39;</span><span class="p">:</span> <span class="s1">&#39;STIXNonUnicode:italic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nonunibf&#39;</span><span class="p">:</span> <span class="s1">&#39;STIXNonUnicode:weight=bold&#39;</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;STIXGeneral&#39;</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;STIXSizeOneSym&#39;</span><span class="p">,</span>
        <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;STIXSizeTwoSym&#39;</span><span class="p">,</span>
        <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;STIXSizeThreeSym&#39;</span><span class="p">,</span>
        <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;STIXSizeFourSym&#39;</span><span class="p">,</span>
        <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;STIXSizeFiveSym&#39;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">use_cmex</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">cm_fallback</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">_sans</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">TruetypeFonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fontmap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fullpath</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullpath</span>

    <span class="k">def</span> <span class="nf">_map_virtual_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">uniindex</span><span class="p">):</span>
        <span class="c1"># Handle these &quot;fonts&quot; that are actually embedded in</span>
        <span class="c1"># other fonts.</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">stix_virtual_fonts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sans</span> <span class="ow">and</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">fontname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;regular&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)):</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">stix_virtual_fonts</span><span class="p">[</span><span class="s1">&#39;sf&#39;</span><span class="p">]</span>
            <span class="n">doing_sans_conversion</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doing_sans_conversion</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mapping</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">font_class</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s1">&#39;rm&#39;</span><span class="p">]</span>

            <span class="c1"># Binary search for the source glyph</span>
            <span class="n">lo</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">hi</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">lo</span> <span class="o">&lt;</span> <span class="n">hi</span><span class="p">:</span>
                <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span><span class="o">+</span><span class="n">hi</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
                <span class="nb">range</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">uniindex</span> <span class="o">&lt;</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">hi</span> <span class="o">=</span> <span class="n">mid</span>
                <span class="k">elif</span> <span class="n">uniindex</span> <span class="o">&lt;=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lo</span> <span class="o">=</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">uniindex</span> <span class="o">&lt;=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="n">uniindex</span> <span class="o">-</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">range</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">doing_sans_conversion</span><span class="p">:</span>
                <span class="c1"># This will generate a dummy character</span>
                <span class="n">uniindex</span> <span class="o">=</span> <span class="mh">0x1</span>
                <span class="n">fontname</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.default&#39;</span><span class="p">]</span>

        <span class="c1"># Handle private use area glyphs</span>
        <span class="k">if</span> <span class="n">fontname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;bf&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="mh">0xe000</span> <span class="o">&lt;=</span> <span class="n">uniindex</span> <span class="o">&lt;=</span> <span class="mh">0xf8ff</span><span class="p">:</span>
            <span class="n">fontname</span> <span class="o">=</span> <span class="s1">&#39;nonuni&#39;</span> <span class="o">+</span> <span class="n">fontname</span>

        <span class="k">return</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">uniindex</span>

<div class="viewcode-block" id="StixFonts.get_sized_alternatives_for_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StixFonts.get_sized_alternatives_for_symbol">[docs]</a>    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">get_sized_alternatives_for_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">):</span>
        <span class="n">fixes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">{&#39;</span><span class="p">:</span> <span class="s1">&#39;{&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">}&#39;</span><span class="p">:</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">[&#39;</span><span class="p">:</span> <span class="s1">&#39;[&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">]&#39;</span><span class="p">:</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\N{MATHEMATICAL LEFT ANGLE BRACKET}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\N{MATHEMATICAL RIGHT ANGLE BRACKET}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">fixes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">sym</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uniindex</span> <span class="o">=</span> <span class="n">get_unicode_index</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">)]</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="n">uniindex</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">get_char_index</span><span class="p">(</span><span class="n">uniindex</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="c1"># The largest size of the radical symbol in STIX has incorrect</span>
        <span class="c1"># metrics that cause it to be disconnected from the stem.</span>
        <span class="k">if</span> <span class="n">sym</span> <span class="o">==</span> <span class="sa">r</span><span class="s1">&#39;\__sqrt__&#39;</span><span class="p">:</span>
            <span class="n">alternatives</span> <span class="o">=</span> <span class="n">alternatives</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">alternatives</span></div></div>


<div class="viewcode-block" id="StixSansFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StixSansFonts">[docs]</a><span class="k">class</span> <span class="nc">StixSansFonts</span><span class="p">(</span><span class="n">StixFonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A font handling class for the STIX fonts (that uses sans-serif</span>
<span class="sd">    characters by default).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_sans</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="StandardPsFonts"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts">[docs]</a><span class="k">class</span> <span class="nc">StandardPsFonts</span><span class="p">(</span><span class="n">Fonts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the standard postscript fonts for rendering to backend_ps</span>

<span class="sd">    Unlike the other font classes, BakomaFont and UnicodeFont, this</span>
<span class="sd">    one requires the Ps backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">basepath</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_get_data_path</span><span class="p">(</span><span class="s1">&#39;fonts/afm&#39;</span><span class="p">))</span>

    <span class="n">fontmap</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cal&#39;</span><span class="p">:</span> <span class="s1">&#39;pzcmi8a&#39;</span><span class="p">,</span>  <span class="c1"># Zapf Chancery</span>
        <span class="s1">&#39;rm&#39;</span><span class="p">:</span>  <span class="s1">&#39;pncr8a&#39;</span><span class="p">,</span>   <span class="c1"># New Century Schoolbook</span>
        <span class="s1">&#39;tt&#39;</span><span class="p">:</span>  <span class="s1">&#39;pcrr8a&#39;</span><span class="p">,</span>   <span class="c1"># Courier</span>
        <span class="s1">&#39;it&#39;</span><span class="p">:</span>  <span class="s1">&#39;pncri8a&#39;</span><span class="p">,</span>  <span class="c1"># New Century Schoolbook Italic</span>
        <span class="s1">&#39;sf&#39;</span><span class="p">:</span>  <span class="s1">&#39;phvr8a&#39;</span><span class="p">,</span>   <span class="c1"># Helvetica</span>
        <span class="s1">&#39;bf&#39;</span><span class="p">:</span>  <span class="s1">&#39;pncb8a&#39;</span><span class="p">,</span>   <span class="c1"># New Century Schoolbook Bold</span>
        <span class="kc">None</span><span class="p">:</span>  <span class="s1">&#39;psyr&#39;</span><span class="p">,</span>     <span class="c1"># Symbol</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">):</span>
        <span class="n">Fonts</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_font_prop</span><span class="p">,</span> <span class="n">MathtextBackendPs</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="n">default_font_prop</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">&#39;afm&#39;</span><span class="p">,</span>
                            <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basepath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">findfont</span><span class="p">(</span><span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span> <span class="n">fontext</span><span class="o">=</span><span class="s1">&#39;afm&#39;</span><span class="p">,</span>
                                <span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">basepath</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">default_font</span> <span class="o">=</span> <span class="n">AFM</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="n">default_font</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="s1">&#39;regular&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pswriter</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontmap</span><span class="p">[</span><span class="n">font</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">font</span>

        <span class="n">cached_font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_font</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basepath</span><span class="p">,</span> <span class="n">basename</span> <span class="o">+</span> <span class="s2">&quot;.afm&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                <span class="n">cached_font</span> <span class="o">=</span> <span class="n">AFM</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="n">cached_font</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="n">basename</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fonts</span><span class="p">[</span><span class="n">cached_font</span><span class="o">.</span><span class="n">get_fontname</span><span class="p">()]</span> <span class="o">=</span> <span class="n">cached_font</span>
        <span class="k">return</span> <span class="n">cached_font</span>

    <span class="k">def</span> <span class="nf">_get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the cmfont, metrics and glyph with caching.&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span>
        <span class="n">tup</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">tup</span>

        <span class="c1"># Only characters in the &quot;Letter&quot; class should really be italicized.</span>
        <span class="c1"># This class includes greek letters, so we&#39;re ok</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fontname</span> <span class="o">==</span> <span class="s1">&#39;it&#39;</span> <span class="ow">and</span>
                <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
                 <span class="ow">or</span> <span class="ow">not</span> <span class="n">unicodedata</span><span class="o">.</span><span class="n">category</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">))):</span>
            <span class="n">fontname</span> <span class="o">=</span> <span class="s1">&#39;rm&#39;</span>

        <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">latex_to_standard</span><span class="p">:</span>
            <span class="n">fontname</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">latex_to_standard</span><span class="p">[</span><span class="n">sym</span><span class="p">]</span>
            <span class="n">glyph</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
            <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">glyph</span> <span class="o">=</span> <span class="n">sym</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
            <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;No TeX to built-in Postscript mapping for </span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span>

        <span class="n">slanted</span> <span class="o">=</span> <span class="p">(</span><span class="n">fontname</span> <span class="o">==</span> <span class="s1">&#39;it&#39;</span><span class="p">)</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">fontname</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_name_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;No glyph in standard Postscript font </span><span class="si">{!r}</span><span class="s2"> for </span><span class="si">{!r}</span><span class="s2">&quot;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">get_fontname</span><span class="p">(),</span> <span class="n">sym</span><span class="p">))</span>
                <span class="n">found_symbol</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">found_symbol</span><span class="p">:</span>
            <span class="n">glyph</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>
            <span class="n">symbol_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_name_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize</span>

        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="o">*</span> <span class="n">scale</span>
                                  <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">font</span><span class="o">.</span><span class="n">get_bbox_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)]</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">(</span>
            <span class="n">advance</span>  <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_width_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="n">width</span>    <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_width_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="n">height</span>   <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_height_char</span><span class="p">(</span><span class="n">glyph</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span>
            <span class="c1"># iceberg is the equivalent of TeX&#39;s &quot;height&quot;</span>
            <span class="n">iceberg</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span>
            <span class="n">slanted</span> <span class="o">=</span> <span class="n">slanted</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">(</span>
            <span class="n">font</span>            <span class="o">=</span> <span class="n">font</span><span class="p">,</span>
            <span class="n">fontsize</span>        <span class="o">=</span> <span class="n">fontsize</span><span class="p">,</span>
            <span class="n">postscript_name</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_fontname</span><span class="p">(),</span>
            <span class="n">metrics</span>         <span class="o">=</span> <span class="n">metrics</span><span class="p">,</span>
            <span class="n">symbol_name</span>     <span class="o">=</span> <span class="n">symbol_name</span><span class="p">,</span>
            <span class="n">num</span>             <span class="o">=</span> <span class="n">num</span><span class="p">,</span>
            <span class="n">glyph</span>           <span class="o">=</span> <span class="n">glyph</span><span class="p">,</span>
            <span class="n">offset</span>          <span class="o">=</span> <span class="n">offset</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">glyphd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<div class="viewcode-block" id="StandardPsFonts.get_kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts.get_kern">[docs]</a>    <span class="k">def</span> <span class="nf">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                 <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">font1</span> <span class="o">==</span> <span class="n">font2</span> <span class="ow">and</span> <span class="n">fontsize1</span> <span class="o">==</span> <span class="n">fontsize2</span><span class="p">:</span>
            <span class="n">info1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">info2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_info</span><span class="p">(</span><span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">info1</span><span class="o">.</span><span class="n">font</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">get_kern_dist</span><span class="p">(</span><span class="n">info1</span><span class="o">.</span><span class="n">glyph</span><span class="p">,</span> <span class="n">info2</span><span class="o">.</span><span class="n">glyph</span><span class="p">)</span>
                    <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Fonts</span><span class="o">.</span><span class="n">get_kern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font1</span><span class="p">,</span> <span class="n">fontclass1</span><span class="p">,</span> <span class="n">sym1</span><span class="p">,</span> <span class="n">fontsize1</span><span class="p">,</span>
                              <span class="n">font2</span><span class="p">,</span> <span class="n">fontclass2</span><span class="p">,</span> <span class="n">sym2</span><span class="p">,</span> <span class="n">fontsize2</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span></div>

<div class="viewcode-block" id="StandardPsFonts.get_xheight"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts.get_xheight">[docs]</a>    <span class="k">def</span> <span class="nf">get_xheight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">font</span><span class="o">.</span><span class="n">get_xheight</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize</span></div>

<div class="viewcode-block" id="StandardPsFonts.get_underline_thickness"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.StandardPsFonts.get_underline_thickness">[docs]</a>    <span class="k">def</span> <span class="nf">get_underline_thickness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">font</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">fontsize</span></div></div>


<span class="c1">##############################################################################</span>
<span class="c1"># TeX-LIKE BOX MODEL</span>

<span class="c1"># The following is based directly on the document &#39;woven&#39; from the</span>
<span class="c1"># TeX82 source code.  This information is also available in printed</span>
<span class="c1"># form:</span>
<span class="c1">#</span>
<span class="c1">#    Knuth, Donald E.. 1986.  Computers and Typesetting, Volume B:</span>
<span class="c1">#    TeX: The Program.  Addison-Wesley Professional.</span>
<span class="c1">#</span>
<span class="c1"># The most relevant &quot;chapters&quot; are:</span>
<span class="c1">#    Data structures for boxes and their friends</span>
<span class="c1">#    Shipping pages out (Ship class)</span>
<span class="c1">#    Packaging (hpack and vpack)</span>
<span class="c1">#    Data structures for math mode</span>
<span class="c1">#    Subroutines for math mode</span>
<span class="c1">#    Typesetting math formulas</span>
<span class="c1">#</span>
<span class="c1"># Many of the docstrings below refer to a numbered &quot;node&quot; in that</span>
<span class="c1"># book, e.g., node123</span>
<span class="c1">#</span>
<span class="c1"># Note that (as TeX) y increases downward, unlike many other parts of</span>
<span class="c1"># matplotlib.</span>

<span class="c1"># How much text shrinks when going to the next-smallest level.  GROW_FACTOR</span>
<span class="c1"># must be the inverse of SHRINK_FACTOR.</span>
<span class="n">SHRINK_FACTOR</span>   <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">GROW_FACTOR</span>     <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">SHRINK_FACTOR</span>
<span class="c1"># The number of different sizes of chars to use, beyond which they will not</span>
<span class="c1"># get any smaller</span>
<span class="n">NUM_SIZE_LEVELS</span> <span class="o">=</span> <span class="mi">6</span>


<div class="viewcode-block" id="FontConstantsBase"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.FontConstantsBase">[docs]</a><span class="k">class</span> <span class="nc">FontConstantsBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A set of constants that controls how certain things, such as sub-</span>
<span class="sd">    and superscripts are laid out.  These are all metrics that can&#39;t</span>
<span class="sd">    be reliably retrieved from the font metrics in the font itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Percentage of x-height of additional horiz. space after sub/superscripts</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.05</span>

    <span class="c1"># Percentage of x-height that sub/superscripts drop below the baseline</span>
    <span class="n">subdrop</span> <span class="o">=</span> <span class="mf">0.4</span>

    <span class="c1"># Percentage of x-height that superscripts are raised from the baseline</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.7</span>

    <span class="c1"># Percentage of x-height that subscripts drop below the baseline</span>
    <span class="n">sub1</span> <span class="o">=</span> <span class="mf">0.3</span>

    <span class="c1"># Percentage of x-height that subscripts drop below the baseline when a</span>
    <span class="c1"># superscript is present</span>
    <span class="n">sub2</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="c1"># Percentage of x-height that sub/supercripts are offset relative to the</span>
    <span class="c1"># nucleus edge for non-slanted nuclei</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.025</span>

    <span class="c1"># Additional percentage of last character height above 2/3 of the</span>
    <span class="c1"># x-height that supercripts are offset relative to the subscript</span>
    <span class="c1"># for slanted nuclei</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="c1"># Percentage of x-height that supercripts and subscripts are offset for</span>
    <span class="c1"># integrals</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.1</span></div>


<div class="viewcode-block" id="ComputerModernFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.ComputerModernFontConstants">[docs]</a><span class="k">class</span> <span class="nc">ComputerModernFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.075</span>
    <span class="n">subdrop</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.45</span>
    <span class="n">sub1</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">sub2</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.075</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.3</span></div>


<div class="viewcode-block" id="STIXFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.STIXFontConstants">[docs]</a><span class="k">class</span> <span class="nc">STIXFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">sub2</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.3</span></div>


<div class="viewcode-block" id="STIXSansFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.STIXSansFontConstants">[docs]</a><span class="k">class</span> <span class="nc">STIXSansFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="n">script_space</span> <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">sup1</span> <span class="o">=</span> <span class="mf">0.8</span>
    <span class="n">delta_slanted</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">delta_integral</span> <span class="o">=</span> <span class="mf">0.3</span></div>


<div class="viewcode-block" id="DejaVuSerifFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSerifFontConstants">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSerifFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="DejaVuSansFontConstants"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.DejaVuSansFontConstants">[docs]</a><span class="k">class</span> <span class="nc">DejaVuSansFontConstants</span><span class="p">(</span><span class="n">FontConstantsBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># Maps font family names to the FontConstantBase subclass to use</span>
<span class="n">_font_constant_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;DejaVu Sans Mono&#39;</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;DejaVu Serif&#39;</span><span class="p">:</span> <span class="n">DejaVuSerifFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;cmb10&#39;</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;cmex10&#39;</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;cmmi10&#39;</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;cmr10&#39;</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;cmss10&#39;</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;cmsy10&#39;</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;cmtt10&#39;</span><span class="p">:</span> <span class="n">ComputerModernFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;STIXGeneral&#39;</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;STIXNonUnicode&#39;</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;STIXSizeFiveSym&#39;</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;STIXSizeFourSym&#39;</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;STIXSizeThreeSym&#39;</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;STIXSizeTwoSym&#39;</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;STIXSizeOneSym&#39;</span><span class="p">:</span> <span class="n">STIXFontConstants</span><span class="p">,</span>
    <span class="c1"># Map the fonts we used to ship, just for good measure</span>
    <span class="s1">&#39;Bitstream Vera Sans&#39;</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="s1">&#39;Bitstream Vera&#39;</span><span class="p">:</span> <span class="n">DejaVuSansFontConstants</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">def</span> <span class="nf">_get_font_constant_set</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="n">constants</span> <span class="o">=</span> <span class="n">_font_constant_mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">)</span><span class="o">.</span><span class="n">family_name</span><span class="p">,</span>
        <span class="n">FontConstantsBase</span><span class="p">)</span>
    <span class="c1"># STIX sans isn&#39;t really its own fonts, just different code points</span>
    <span class="c1"># in the STIX fonts, so we have to detect this one separately.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">constants</span> <span class="ow">is</span> <span class="n">STIXFontConstants</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="p">,</span> <span class="n">StixSansFonts</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">STIXSansFontConstants</span>
    <span class="k">return</span> <span class="n">constants</span>


<div class="viewcode-block" id="MathTextWarning"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextWarning">[docs]</a><span class="k">class</span> <span class="nc">MathTextWarning</span><span class="p">(</span><span class="ne">Warning</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="Node"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node">[docs]</a><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A node in the TeX box model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

<div class="viewcode-block" id="Node.get_kerning"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.get_kerning">[docs]</a>    <span class="k">def</span> <span class="nf">get_kerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">next</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span></div>

<div class="viewcode-block" id="Node.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shrinks one level smaller.  There are only three levels of</span>
<span class="sd">        sizes, after which things will no longer get smaller.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Node.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grows one level larger.  There is no limit to how big</span>
<span class="sd">        something can get.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Node.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Node.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Box"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box">[docs]</a><span class="k">class</span> <span class="nc">Box</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A node with a physical location.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">=</span> <span class="n">depth</span>

<div class="viewcode-block" id="Box.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="Box.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div>

<div class="viewcode-block" id="Box.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Box.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Vbox"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vbox">[docs]</a><span class="k">class</span> <span class="nc">Vbox</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A box with only height (zero width).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span></div>


<div class="viewcode-block" id="Hbox"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hbox">[docs]</a><span class="k">class</span> <span class="nc">Hbox</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A box with only width (zero height and depth).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span></div>


<div class="viewcode-block" id="Char"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char">[docs]</a><span class="k">class</span> <span class="nc">Char</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A single character.</span>

<span class="sd">    Unlike TeX, the font information and metrics are stored with each `Char`</span>
<span class="sd">    to make it easier to lookup the font metrics when needed.  Note that TeX</span>
<span class="sd">    boxes have a width, height, and depth, unlike Type1 and TrueType which use</span>
<span class="sd">    a full bounding box and an advance in the x-direction.  The metrics must</span>
<span class="sd">    be converted to the TeX model, and the advance (if different from width)</span>
<span class="sd">    must be converted into a `Kern` node when the `Char` is added to its parent</span>
<span class="sd">    `Hlist`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">math</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">math</span> <span class="o">=</span> <span class="n">math</span>
        <span class="c1"># The real width, height and depth will be set during the</span>
        <span class="c1"># pack phase, after we know the real fontsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">`&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_update_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">math</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">advance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">iceberg</span> <span class="o">-</span> <span class="n">metrics</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

<div class="viewcode-block" id="Char.is_slanted"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.is_slanted">[docs]</a>    <span class="k">def</span> <span class="nf">is_slanted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">slanted</span></div>

<div class="viewcode-block" id="Char.get_kerning"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.get_kerning">[docs]</a>    <span class="k">def</span> <span class="nf">get_kerning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">next</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the amount of kerning between this and the given character.</span>

<span class="sd">        This method is called when characters are strung together into `Hlist`</span>
<span class="sd">        to create `Kern` nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">advance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">advance</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">next</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="n">kern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_kern</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="nb">next</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="nb">next</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="nb">next</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="nb">next</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">advance</span> <span class="o">+</span> <span class="n">kern</span></div>

<div class="viewcode-block" id="Char.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the character to the canvas</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">render_glyph</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span></div>

<div class="viewcode-block" id="Char.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span>    <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">height</span>   <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>    <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="Char.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Char.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>    <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span>   <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>    <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div></div>


<div class="viewcode-block" id="Accent"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent">[docs]</a><span class="k">class</span> <span class="nc">Accent</span><span class="p">(</span><span class="n">Char</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The font metrics need to be dealt with differently for accents,</span>
<span class="sd">    since they are already offset correctly from the baseline in</span>
<span class="sd">    TrueType fonts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_update_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">metrics</span><span class="o">.</span><span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ymin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Accent.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Char</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span></div>

<div class="viewcode-block" id="Accent.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Char</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span></div>

<div class="viewcode-block" id="Accent.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Accent.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the character to the canvas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">render_glyph</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="List"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.List">[docs]</a><span class="k">class</span> <span class="nc">List</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A list of nodes (either horizontal or vertical).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># An arbitrary offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span>     <span class="o">=</span> <span class="n">elements</span>  <span class="c1"># The child nodes of this list</span>
        <span class="c1"># The following parameters are set in the vpack and hpack functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span>     <span class="o">=</span> <span class="mf">0.</span>   <span class="c1"># The glue setting of this list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span>    <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># 0: normal, -1: shrinking, 1: stretching</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span>   <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># The order of infinity (0 - 3) for the glue</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;[</span><span class="si">%s</span><span class="s1"> &lt;</span><span class="si">%.02f</span><span class="s1"> </span><span class="si">%.02f</span><span class="s1"> </span><span class="si">%.02f</span><span class="s1"> </span><span class="si">%.02f</span><span class="s1">&gt; </span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span><span class="p">,</span>
            <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_determine_order</span><span class="p">(</span><span class="n">totals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the highest order of glue used by the members of this list.</span>

<span class="sd">        Helper function used by vpack and hpack.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">totals</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">totals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_set_glue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">totals</span><span class="p">,</span> <span class="n">error_type</span><span class="p">):</span>
        <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_order</span><span class="p">(</span><span class="n">totals</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span> <span class="o">=</span> <span class="n">o</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="n">sign</span>
        <span class="k">if</span> <span class="n">totals</span><span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">totals</span><span class="p">[</span><span class="n">o</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_ratio</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">):</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="p">,</span>
                             <span class="n">error_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="List.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.List.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
        <span class="n">Box</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span>     <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="List.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.List.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="n">child</span><span class="o">.</span><span class="n">grow</span><span class="p">()</span>
        <span class="n">Box</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_set</span>     <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div></div>


<div class="viewcode-block" id="Hlist"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hlist">[docs]</a><span class="k">class</span> <span class="nc">Hlist</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A horizontal list of boxes.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">&#39;additional&#39;</span><span class="p">,</span> <span class="n">do_kern</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">List</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">do_kern</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kern</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hpack</span><span class="p">()</span>

<div class="viewcode-block" id="Hlist.kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hlist.kern">[docs]</a>    <span class="k">def</span> <span class="nf">kern</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert `Kern` nodes between `Char` nodes to set kerning.</span>

<span class="sd">        The `Char` nodes themselves determine the amount of kerning they need</span>
<span class="sd">        (in `~Char.get_kerning`), and this function just creates the correct</span>
<span class="sd">        linked list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_children</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">num_children</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">num_children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_children</span><span class="p">):</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_children</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">next</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
                <span class="n">kerning_distance</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get_kerning</span><span class="p">(</span><span class="nb">next</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kerning_distance</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">kern</span> <span class="o">=</span> <span class="n">Kern</span><span class="p">(</span><span class="n">kerning_distance</span><span class="p">)</span>
                    <span class="n">new_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kern</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="n">new_children</span></div>

    <span class="c1"># This is a failed experiment to fake cross-font kerning.</span>
<span class="c1">#     def get_kerning(self, next):</span>
<span class="c1">#         if len(self.children) &gt;= 2 and isinstance(self.children[-2], Char):</span>
<span class="c1">#             if isinstance(next, Char):</span>
<span class="c1">#                 print &quot;CASE A&quot;</span>
<span class="c1">#                 return self.children[-2].get_kerning(next)</span>
<span class="c1">#             elif (isinstance(next, Hlist) and len(next.children)</span>
<span class="c1">#                   and isinstance(next.children[0], Char)):</span>
<span class="c1">#                 print &quot;CASE B&quot;</span>
<span class="c1">#                 result = self.children[-2].get_kerning(next.children[0])</span>
<span class="c1">#                 print result</span>
<span class="c1">#                 return result</span>
<span class="c1">#         return 0.0</span>

<div class="viewcode-block" id="Hlist.hpack"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hlist.hpack">[docs]</a>    <span class="k">def</span> <span class="nf">hpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">&#39;additional&#39;</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the dimensions of the resulting boxes, and adjust the glue if</span>
<span class="sd">        one of those dimensions is pre-specified.  The computed sizes normally</span>
<span class="sd">        enclose all of the material inside the new box; but some items may</span>
<span class="sd">        stick out if negative glue is used, if the box is overfull, or if a</span>
<span class="sd">        ``\vbox`` includes other boxes that have been shifted left.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        w : float, default: 0</span>
<span class="sd">            A width.</span>
<span class="sd">        m : {&#39;exactly&#39;, &#39;additional&#39;}, default: &#39;additional&#39;</span>
<span class="sd">            Whether to produce a box whose width is &#39;exactly&#39; *w*; or a box</span>
<span class="sd">            with the natural width of the contents, plus *w* (&#39;additional&#39;).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The defaults produce a box with the natural width of the contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># I don&#39;t know why these get reset in TeX.  Shift_amount is pretty</span>
        <span class="c1"># much useless if we do.</span>
        <span class="c1"># self.shift_amount = 0.</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">total_stretch</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">total_shrink</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">depth</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;shift_amount&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
                    <span class="n">h</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span>
                <span class="n">total_stretch</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                <span class="n">total_shrink</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">d</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s1">&#39;additional&#39;</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="n">x</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_ratio</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_stretch</span><span class="p">,</span> <span class="s2">&quot;Overfull&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_shrink</span><span class="p">,</span> <span class="s2">&quot;Underfull&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Vlist"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vlist">[docs]</a><span class="k">class</span> <span class="nc">Vlist</span><span class="p">(</span><span class="n">List</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A vertical list of boxes.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">&#39;additional&#39;</span><span class="p">):</span>
        <span class="n">List</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vpack</span><span class="p">()</span>

<div class="viewcode-block" id="Vlist.vpack"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vlist.vpack">[docs]</a>    <span class="k">def</span> <span class="nf">vpack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="s1">&#39;additional&#39;</span><span class="p">,</span> <span class="n">l</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the dimensions of the resulting boxes, and to adjust the glue</span>
<span class="sd">        if one of those dimensions is pre-specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        h : float, default: 0</span>
<span class="sd">            A height.</span>
<span class="sd">        m : {&#39;exactly&#39;, &#39;additional&#39;}, default: &#39;additional&#39;</span>
<span class="sd">            Whether to produce a box whose height is &#39;exactly&#39; *w*; or a box</span>
<span class="sd">            with the natural height of the contents, plus *w* (&#39;additional&#39;).</span>
<span class="sd">        l : float, default: np.inf</span>
<span class="sd">            The maximum height.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The defaults produce a box with the natural height of the contents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># I don&#39;t know why these get reset in TeX.  Shift_amount is pretty</span>
        <span class="c1"># much useless if we do.</span>
        <span class="c1"># self.shift_amount = 0.</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">total_stretch</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="n">total_shrink</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">width</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s1">&#39;shift_amount&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span>
                <span class="n">total_stretch</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                <span class="n">total_shrink</span><span class="p">[</span><span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span><span class="p">]</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="n">d</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Internal mathtext error: Char node found in Vlist&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">w</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">l</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">d</span> <span class="o">-</span> <span class="n">l</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">l</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">d</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s1">&#39;additional&#39;</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">+=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="n">x</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_sign</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_order</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_ratio</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">total_stretch</span><span class="p">,</span> <span class="s2">&quot;Overfull&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_glue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_shrink</span><span class="p">,</span> <span class="s2">&quot;Underfull&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Rule"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Rule">[docs]</a><span class="k">class</span> <span class="nc">Rule</span><span class="p">(</span><span class="n">Box</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A solid black rectangle.</span>

<span class="sd">    It has *width*, *depth*, and *height* fields just as in an `Hlist`.</span>
<span class="sd">    However, if any of these dimensions is inf, the actual value will be</span>
<span class="sd">    determined by running the rule up to the boundary of the innermost</span>
<span class="sd">    enclosing box.  This is called a &quot;running dimension&quot;.  The width is never</span>
<span class="sd">    running in an `Hlist`; the height and depth are never running in a `Vlist`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">Box</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span>

<div class="viewcode-block" id="Rule.render"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Rule.render">[docs]</a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">render_rect_filled</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Hrule"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Hrule">[docs]</a><span class="k">class</span> <span class="nc">Hrule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convenience class to create a horizontal rule.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">=</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="n">Rule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span></div>


<div class="viewcode-block" id="Vrule"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Vrule">[docs]</a><span class="k">class</span> <span class="nc">Vrule</span><span class="p">(</span><span class="n">Rule</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convenience class to create a vertical rule.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">Rule</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span></div>


<span class="n">_GlueSpec</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span>
    <span class="s2">&quot;_GlueSpec&quot;</span><span class="p">,</span> <span class="s2">&quot;width stretch stretch_order shrink shrink_order&quot;</span><span class="p">)</span>
<span class="n">_GlueSpec</span><span class="o">.</span><span class="n">_named</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fil&#39;</span><span class="p">:</span>         <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;fill&#39;</span><span class="p">:</span>        <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;filll&#39;</span><span class="p">:</span>       <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;neg_fil&#39;</span><span class="p">:</span>     <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;neg_fill&#39;</span><span class="p">:</span>    <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="s1">&#39;neg_filll&#39;</span><span class="p">:</span>   <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
    <span class="s1">&#39;empty&#39;</span><span class="p">:</span>       <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="s1">&#39;ss&#39;</span><span class="p">:</span>          <span class="n">_GlueSpec</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">}</span>


<div class="viewcode-block" id="Glue"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Glue">[docs]</a><span class="k">class</span> <span class="nc">Glue</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Most of the information in this object is stored in the underlying</span>
<span class="sd">    ``_GlueSpec`` class, which is shared between multiple glue objects.</span>
<span class="sd">    (This is a memory optimization which probably doesn&#39;t matter anymore, but</span>
<span class="sd">    it&#39;s easier to stick to what TeX does.)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">glue_subtype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;normal&quot;</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">_delete_parameter</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="s2">&quot;copy&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">glue_type</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">_GlueSpec</span><span class="o">.</span><span class="n">_named</span><span class="p">[</span><span class="n">glue_type</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">glue_type</span><span class="p">,</span> <span class="n">_GlueSpec</span><span class="p">):</span>
            <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">glue_type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;glue_type must be a glue spec name or instance&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span> <span class="o">=</span> <span class="n">glue_spec</span>

<div class="viewcode-block" id="Glue.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Glue.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">SHRINK_FACTOR</span><span class="p">)</span></div>

<div class="viewcode-block" id="Glue.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Glue.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glue_spec</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">g</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">GROW_FACTOR</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="GlueSpec"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.GlueSpec">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">GlueSpec</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;See `Glue`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">stretch_order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">shrink</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">shrink_order</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>         <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span>       <span class="o">=</span> <span class="n">stretch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stretch_order</span> <span class="o">=</span> <span class="n">stretch_order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shrink</span>        <span class="o">=</span> <span class="n">shrink</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shrink_order</span>  <span class="o">=</span> <span class="n">shrink_order</span>

<div class="viewcode-block" id="GlueSpec.copy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.GlueSpec.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GlueSpec</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stretch_order</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shrink</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shrink_order</span><span class="p">)</span></div>

<div class="viewcode-block" id="GlueSpec.factory"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.GlueSpec.factory">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">factory</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">glue_type</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_types</span><span class="p">[</span><span class="n">glue_type</span><span class="p">]</span></div></div>


<span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_suppress_matplotlib_deprecation_warning</span><span class="p">():</span>
    <span class="n">GlueSpec</span><span class="o">.</span><span class="n">_types</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">GlueSpec</span><span class="p">(</span><span class="o">**</span><span class="n">v</span><span class="o">.</span><span class="n">_asdict</span><span class="p">())</span>
                       <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_GlueSpec</span><span class="o">.</span><span class="n">_named</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>


<span class="c1"># Some convenient ways to get common kinds of glue</span>


<div class="viewcode-block" id="Fil"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fil">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Glue(&#39;fil&#39;)&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Fil</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;fil&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fill"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Fill">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Glue(&#39;fill&#39;)&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Fill</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;fill&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Filll"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Filll">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Glue(&#39;filll&#39;)&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Filll</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;filll&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NegFil"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.NegFil">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Glue(&#39;neg_fil&#39;)&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NegFil</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;neg_fil&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NegFill"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.NegFill">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Glue(&#39;neg_fill&#39;)&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NegFill</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;neg_fill&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="NegFilll"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.NegFilll">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Glue(&#39;neg_filll&#39;)&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NegFilll</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;neg_filll&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SsGlue"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.SsGlue">[docs]</a><span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;Glue(&#39;ss&#39;)&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SsGlue</span><span class="p">(</span><span class="n">Glue</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Glue</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ss&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="HCentered"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.HCentered">[docs]</a><span class="k">class</span> <span class="nc">HCentered</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A convenience class to create an `Hlist` whose contents are</span>
<span class="sd">    centered within its enclosing box.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">([</span><span class="n">Glue</span><span class="p">(</span><span class="s1">&#39;ss&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">elements</span><span class="p">,</span> <span class="n">Glue</span><span class="p">(</span><span class="s1">&#39;ss&#39;</span><span class="p">)],</span> <span class="n">do_kern</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="VCentered"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.VCentered">[docs]</a><span class="k">class</span> <span class="nc">VCentered</span><span class="p">(</span><span class="n">Vlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A convenience class to create a `Vlist` whose contents are</span>
<span class="sd">    centered within its enclosing box.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">([</span><span class="n">Glue</span><span class="p">(</span><span class="s1">&#39;ss&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">elements</span><span class="p">,</span> <span class="n">Glue</span><span class="p">(</span><span class="s1">&#39;ss&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="Kern"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Kern">[docs]</a><span class="k">class</span> <span class="nc">Kern</span><span class="p">(</span><span class="n">Node</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A `Kern` node has a width field to specify a (normally</span>
<span class="sd">    negative) amount of spacing. This spacing correction appears in</span>
<span class="sd">    horizontal lists between letters like A and V when the font</span>
<span class="sd">    designer said that it looks better to move them closer together or</span>
<span class="sd">    further apart. A kern node can also appear in a vertical list,</span>
<span class="sd">    when its *width* denotes additional spacing in the vertical</span>
<span class="sd">    direction.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;k</span><span class="si">%.02f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>

<div class="viewcode-block" id="Kern.shrink"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Kern.shrink">[docs]</a>    <span class="k">def</span> <span class="nf">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">shrink</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">NUM_SIZE_LEVELS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="n">SHRINK_FACTOR</span></div>

<div class="viewcode-block" id="Kern.grow"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Kern.grow">[docs]</a>    <span class="k">def</span> <span class="nf">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Node</span><span class="o">.</span><span class="n">grow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*=</span> <span class="n">GROW_FACTOR</span></div></div>


<div class="viewcode-block" id="SubSuperCluster"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.SubSuperCluster">[docs]</a><span class="k">class</span> <span class="nc">SubSuperCluster</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A hack to get around that fact that this code does a two-pass parse like</span>
<span class="sd">    TeX.  This lets us store enough information in the hlist itself, namely the</span>
<span class="sd">    nucleus, sub- and super-script, such that if another script follows that</span>
<span class="sd">    needs to be attached, it can be reconfigured on the fly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nucleus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">super</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">Hlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[])</span></div>


<div class="viewcode-block" id="AutoHeightChar"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.AutoHeightChar">[docs]</a><span class="k">class</span> <span class="nc">AutoHeightChar</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A character as close to the given height and depth as possible.</span>

<span class="sd">    When using a font with multiple height versions of some characters (such as</span>
<span class="sd">    the BaKoMa fonts), the correct glyph will be selected, otherwise this will</span>
<span class="sd">    always just return a scaled version of the glyph.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_sized_alternatives_for_symbol</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="n">xHeight</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_xheight</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">target_total</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="n">depth</span>
        <span class="k">for</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">alternatives</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontname</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="c1"># Ensure that size 0 is chosen when the text is regular sized but</span>
            <span class="c1"># with descender glyphs by subtracting 0.2 * xHeight</span>
            <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">depth</span> <span class="o">&gt;=</span> <span class="n">target_total</span> <span class="o">-</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">xHeight</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">shift</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="n">target_total</span> <span class="o">/</span> <span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">char</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
            <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">factor</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

            <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">depth</span> <span class="o">-</span> <span class="n">char</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>

        <span class="n">Hlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">char</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift</span></div>


<div class="viewcode-block" id="AutoWidthChar"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.AutoWidthChar">[docs]</a><span class="k">class</span> <span class="nc">AutoWidthChar</span><span class="p">(</span><span class="n">Hlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A character as close to the given width as possible.</span>

<span class="sd">    When using a font with multiple width versions of some characters (such as</span>
<span class="sd">    the BaKoMa fonts), the correct glyph will be selected, otherwise this will</span>
<span class="sd">    always just return a scaled version of the glyph.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">char_class</span><span class="o">=</span><span class="n">Char</span><span class="p">):</span>
        <span class="n">alternatives</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_sized_alternatives_for_symbol</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fontname</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="n">alternatives</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontname</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">char_class</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;=</span> <span class="n">width</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">factor</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span>
        <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">char</span> <span class="o">=</span> <span class="n">char_class</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

        <span class="n">Hlist</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">char</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">char</span><span class="o">.</span><span class="n">width</span></div>


<div class="viewcode-block" id="Ship"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship">[docs]</a><span class="k">class</span> <span class="nc">Ship</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ship boxes to output once they have been set up, this sends them to output.</span>

<span class="sd">    Since boxes can be inside of boxes inside of boxes, the main work of `Ship`</span>
<span class="sd">    is done by two mutually recursive routines, `hlist_out` and `vlist_out`,</span>
<span class="sd">    which traverse the `Hlist` nodes and `Vlist` nodes inside of horizontal</span>
<span class="sd">    and vertical boxes.  The global variables used in TeX to store state as it</span>
<span class="sd">    processes have become member variables here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ox</span><span class="p">,</span> <span class="n">oy</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span>    <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Deepest nesting of push commands so far</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span>       <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>       <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>       <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span>       <span class="o">=</span> <span class="n">ox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span>       <span class="o">=</span> <span class="n">oy</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hlist_out</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

<div class="viewcode-block" id="Ship.clamp"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship.clamp">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">clamp</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1000000000.</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">1000000000.</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mf">1000000000.</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1000000000.</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Ship.hlist_out"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship.hlist_out">[docs]</a>    <span class="k">def</span> <span class="nf">hlist_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="n">cur_g</span>         <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur_glue</span>      <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">glue_order</span>    <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_order</span>
        <span class="n">glue_sign</span>     <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_sign</span>
        <span class="n">base_line</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>
        <span class="n">left_edge</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span>    <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span><span class="p">)</span>
        <span class="n">clamp</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clamp</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">box</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">p</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                <span class="c1"># node623</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">edge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">shift_amount</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># p.vpack(box.height + box.depth, &#39;exactly&#39;)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">=</span> <span class="n">edge</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="c1"># node624</span>
                <span class="n">rule_height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                <span class="n">rule_depth</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="n">rule_width</span>  <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">rule_height</span><span class="p">):</span>
                    <span class="n">rule_height</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">rule_depth</span><span class="p">):</span>
                    <span class="n">rule_depth</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">depth</span>
                <span class="k">if</span> <span class="n">rule_height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rule_width</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span> <span class="o">+</span> <span class="n">rule_depth</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span><span class="p">,</span>
                             <span class="n">rule_width</span><span class="p">,</span> <span class="n">rule_height</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">base_line</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">rule_width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="c1"># node625</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">rule_width</span> <span class="o">=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">cur_g</span>
                <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># normal</span>
                    <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># stretching</span>
                        <span class="k">if</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span>
                            <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                            <span class="n">cur_g</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span>
                        <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
                        <span class="n">cur_g</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                <span class="n">rule_width</span> <span class="o">+=</span> <span class="n">cur_g</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+=</span> <span class="n">rule_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span> <span class="o">-=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Ship.vlist_out"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Ship.vlist_out">[docs]</a>    <span class="k">def</span> <span class="nf">vlist_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">box</span><span class="p">):</span>
        <span class="n">cur_g</span>         <span class="o">=</span> <span class="mi">0</span>
        <span class="n">cur_glue</span>      <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">glue_order</span>    <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_order</span>
        <span class="n">glue_sign</span>     <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">glue_sign</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span>    <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_push</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_push</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span><span class="p">)</span>
        <span class="n">left_edge</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>    <span class="o">-=</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">top_edge</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>
        <span class="n">clamp</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clamp</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">box</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">=</span> <span class="n">left_edge</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">shift_amount</span>
                    <span class="n">save_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">hlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">vlist_out</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">=</span> <span class="n">save_v</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">=</span> <span class="n">left_edge</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Box</span><span class="p">):</span>
                <span class="n">rule_height</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">height</span>
                <span class="n">rule_depth</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">depth</span>
                <span class="n">rule_width</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">width</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">rule_width</span><span class="p">):</span>
                    <span class="n">rule_width</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
                <span class="n">rule_height</span> <span class="o">+=</span> <span class="n">rule_depth</span>
                <span class="k">if</span> <span class="n">rule_height</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rule_depth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">rule_height</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur_h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_h</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">off_v</span><span class="p">,</span>
                             <span class="n">rule_width</span><span class="p">,</span> <span class="n">rule_height</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Glue</span><span class="p">):</span>
                <span class="n">glue_spec</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">glue_spec</span>
                <span class="n">rule_height</span> <span class="o">=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">cur_g</span>
                <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># normal</span>
                    <span class="k">if</span> <span class="n">glue_sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># stretching</span>
                        <span class="k">if</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span>
                            <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">stretch</span>
                            <span class="n">cur_g</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink_order</span> <span class="o">==</span> <span class="n">glue_order</span><span class="p">:</span>  <span class="c1"># shrinking</span>
                        <span class="n">cur_glue</span> <span class="o">+=</span> <span class="n">glue_spec</span><span class="o">.</span><span class="n">shrink</span>
                        <span class="n">cur_g</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">clamp</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">glue_set</span> <span class="o">*</span> <span class="n">cur_glue</span><span class="p">))</span>
                <span class="n">rule_height</span> <span class="o">+=</span> <span class="n">cur_g</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur_v</span> <span class="o">+=</span> <span class="n">rule_height</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Internal mathtext error: Char node found in vlist&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur_s</span> <span class="o">-=</span> <span class="mi">1</span></div></div>


<span class="n">ship</span> <span class="o">=</span> <span class="n">Ship</span><span class="p">()</span>


<span class="c1">##############################################################################</span>
<span class="c1"># PARSER</span>


<div class="viewcode-block" id="Error"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Error">[docs]</a><span class="k">def</span> <span class="nf">Error</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Helper class to raise parser errors.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">raise_error</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="n">empty</span> <span class="o">=</span> <span class="n">Empty</span><span class="p">()</span>
    <span class="n">empty</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="n">raise_error</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">empty</span></div>


<div class="viewcode-block" id="Parser"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser">[docs]</a><span class="k">class</span> <span class="nc">Parser</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A pyparsing-based parser for strings containing math expressions.</span>

<span class="sd">    Raw text may also appear outside of pairs of ``$``.</span>

<span class="sd">    The grammar is based directly on that in TeX, though it cuts a few corners.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_math_style_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">displaystyle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">textstyle</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">scriptstyle</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">scriptscriptstyle</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">_binary_operators</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">      + * -</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">pm             </span><span class="se">\\</span><span class="s1">sqcap                   </span><span class="se">\\</span><span class="s1">rhd</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">mp             </span><span class="se">\\</span><span class="s1">sqcup                   </span><span class="se">\\</span><span class="s1">unlhd</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">times          </span><span class="se">\\</span><span class="s1">vee                     </span><span class="se">\\</span><span class="s1">unrhd</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">div            </span><span class="se">\\</span><span class="s1">wedge                   </span><span class="se">\\</span><span class="s1">oplus</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">ast            </span><span class="se">\\</span><span class="s1">setminus                </span><span class="se">\\</span><span class="s1">ominus</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">star           </span><span class="se">\\</span><span class="s1">wr                      </span><span class="se">\\</span><span class="s1">otimes</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">circ           </span><span class="se">\\</span><span class="s1">diamond                 </span><span class="se">\\</span><span class="s1">oslash</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">bullet         </span><span class="se">\\</span><span class="s1">bigtriangleup           </span><span class="se">\\</span><span class="s1">odot</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">cdot           </span><span class="se">\\</span><span class="s1">bigtriangledown         </span><span class="se">\\</span><span class="s1">bigcirc</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">cap            </span><span class="se">\\</span><span class="s1">triangleleft            </span><span class="se">\\</span><span class="s1">dagger</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">cup            </span><span class="se">\\</span><span class="s1">triangleright           </span><span class="se">\\</span><span class="s1">ddagger</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">uplus          </span><span class="se">\\</span><span class="s1">lhd                     </span><span class="se">\\</span><span class="s1">amalg&#39;&#39;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_relation_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">      = &lt; &gt; :</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leq        </span><span class="se">\\</span><span class="s1">geq        </span><span class="se">\\</span><span class="s1">equiv   </span><span class="se">\\</span><span class="s1">models</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">prec       </span><span class="se">\\</span><span class="s1">succ       </span><span class="se">\\</span><span class="s1">sim     </span><span class="se">\\</span><span class="s1">perp</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">preceq     </span><span class="se">\\</span><span class="s1">succeq     </span><span class="se">\\</span><span class="s1">simeq   </span><span class="se">\\</span><span class="s1">mid</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">ll         </span><span class="se">\\</span><span class="s1">gg         </span><span class="se">\\</span><span class="s1">asymp   </span><span class="se">\\</span><span class="s1">parallel</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">subset     </span><span class="se">\\</span><span class="s1">supset     </span><span class="se">\\</span><span class="s1">approx  </span><span class="se">\\</span><span class="s1">bowtie</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">subseteq   </span><span class="se">\\</span><span class="s1">supseteq   </span><span class="se">\\</span><span class="s1">cong    </span><span class="se">\\</span><span class="s1">Join</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">sqsubset   </span><span class="se">\\</span><span class="s1">sqsupset   </span><span class="se">\\</span><span class="s1">neq     </span><span class="se">\\</span><span class="s1">smile</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">sqsubseteq </span><span class="se">\\</span><span class="s1">sqsupseteq </span><span class="se">\\</span><span class="s1">doteq   </span><span class="se">\\</span><span class="s1">frown</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">in         </span><span class="se">\\</span><span class="s1">ni         </span><span class="se">\\</span><span class="s1">propto  </span><span class="se">\\</span><span class="s1">vdash</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">dashv      </span><span class="se">\\</span><span class="s1">dots       </span><span class="se">\\</span><span class="s1">dotplus </span><span class="se">\\</span><span class="s1">doteqdot&#39;&#39;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_arrow_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftarrow              </span><span class="se">\\</span><span class="s1">longleftarrow           </span><span class="se">\\</span><span class="s1">uparrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">Leftarrow              </span><span class="se">\\</span><span class="s1">Longleftarrow           </span><span class="se">\\</span><span class="s1">Uparrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">rightarrow             </span><span class="se">\\</span><span class="s1">longrightarrow          </span><span class="se">\\</span><span class="s1">downarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">Rightarrow             </span><span class="se">\\</span><span class="s1">Longrightarrow          </span><span class="se">\\</span><span class="s1">Downarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftrightarrow         </span><span class="se">\\</span><span class="s1">longleftrightarrow      </span><span class="se">\\</span><span class="s1">updownarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">Leftrightarrow         </span><span class="se">\\</span><span class="s1">Longleftrightarrow      </span><span class="se">\\</span><span class="s1">Updownarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">mapsto                 </span><span class="se">\\</span><span class="s1">longmapsto              </span><span class="se">\\</span><span class="s1">nearrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">hookleftarrow          </span><span class="se">\\</span><span class="s1">hookrightarrow          </span><span class="se">\\</span><span class="s1">searrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftharpoonup          </span><span class="se">\\</span><span class="s1">rightharpoonup          </span><span class="se">\\</span><span class="s1">swarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">leftharpoondown        </span><span class="se">\\</span><span class="s1">rightharpoondown        </span><span class="se">\\</span><span class="s1">nwarrow</span>
<span class="s1">      </span><span class="se">\\</span><span class="s1">rightleftharpoons      </span><span class="se">\\</span><span class="s1">leadsto&#39;&#39;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_spaced_symbols</span> <span class="o">=</span> <span class="n">_binary_operators</span> <span class="o">|</span> <span class="n">_relation_symbols</span> <span class="o">|</span> <span class="n">_arrow_symbols</span>

    <span class="n">_punctuation_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;, ; . ! \ldotp \cdotp&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_overunder_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">       \sum \prod \coprod \bigcap \bigcup \bigsqcup \bigvee</span>
<span class="s1">       \bigwedge \bigodot \bigotimes \bigoplus \biguplus</span>
<span class="s1">       &#39;&#39;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_overunder_functions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="s2">&quot;lim liminf limsup sup max min&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_dropsub_symbols</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&#39;&#39;\int \oint&#39;&#39;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_fontnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;rm cal it tt sf bf default bb frak scr regular&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_function_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      arccos csc ker min arcsin deg lg Pr arctan det lim sec arg dim</span>
<span class="s2">      liminf sin cos exp limsup sinh cosh gcd ln sup cot hom log tan</span>
<span class="s2">      coth inf max tanh&quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_ambi_delim</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      | </span><span class="se">\\</span><span class="s2">| / </span><span class="se">\\</span><span class="s2">backslash </span><span class="se">\\</span><span class="s2">uparrow </span><span class="se">\\</span><span class="s2">downarrow </span><span class="se">\\</span><span class="s2">updownarrow </span><span class="se">\\</span><span class="s2">Uparrow</span>
<span class="s2">      </span><span class="se">\\</span><span class="s2">Downarrow </span><span class="se">\\</span><span class="s2">Updownarrow . </span><span class="se">\\</span><span class="s2">vert </span><span class="se">\\</span><span class="s2">Vert </span><span class="se">\\\\</span><span class="s2">|&quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_left_delim</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;( [ \{ &lt; \lfloor \langle \lceil&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="n">_right_delim</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;) ] \} &gt; \rfloor \rangle \rceil&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SimpleNamespace</span><span class="p">()</span>
        <span class="c1"># All forward declarations are here</span>
        <span class="n">p</span><span class="o">.</span><span class="n">accent</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">binom</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">bslash</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">c_over_c</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">customspace</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">end_group</span>        <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span>    <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">font</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">frac</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">dfrac</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">function</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">genfrac</span>          <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">group</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">int_literal</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">latexfont</span>        <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lbracket</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">left_delim</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">main</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">math</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">math_string</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">non_math</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">operatorname</span>     <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">overline</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">placeable</span>        <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbracket</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">required_group</span>   <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim_safe</span> <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">simple</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">simple_group</span>     <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">single_symbol</span>    <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">accentprefixed</span>   <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">space</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">sqrt</span>             <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">stackrel</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">start_group</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">subsuper</span>         <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">subsuperop</span>       <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol</span>           <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol_name</span>      <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">token</span>            <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span>   <span class="o">=</span> <span class="n">Forward</span><span class="p">()</span>

        <span class="c1"># Set names on everything -- very useful for debugging</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="n">val</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span> <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[-+]?([0-9]+\.?[0-9]*|\.[0-9]+)&quot;</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">int_literal</span>   <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="s2">&quot;[-+]?[0-9]+&quot;</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>        <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span>        <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">lbracket</span>      <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">rbracket</span>      <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">suppress</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">bslash</span>        <span class="o">&lt;&lt;=</span> <span class="n">Literal</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">space</span>         <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_space_widths</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">customspace</span>   <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\hspace&#39;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Expected \hspace</span><span class="si">{n}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">unicode_range</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\U00000080</span><span class="s2">-</span><span class="se">\U0001ffff</span><span class="s2">&quot;</span>
        <span class="n">p</span><span class="o">.</span><span class="n">single_symbol</span> <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;([a-zA-Z0-9 +\-*/&lt;&gt;=:,.;!\?&amp;&#39;@()\[\]|</span><span class="si">%s</span><span class="s2">])|(</span><span class="se">\\</span><span class="s2">[</span><span class="si">%%</span><span class="s2">$</span><span class="si">{}</span><span class="s2">\[\]_|])&quot;</span> <span class="o">%</span>
            <span class="n">unicode_range</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">accentprefixed</span> <span class="o">&lt;&lt;=</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_accentprefixed</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol_name</span>   <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">Combine</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tex2uni</span><span class="p">)))</span>
            <span class="o">+</span> <span class="n">FollowedBy</span><span class="p">(</span><span class="n">Regex</span><span class="p">(</span><span class="s2">&quot;[^A-Za-z]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">leaveWhitespace</span><span class="p">()</span> <span class="o">|</span> <span class="n">StringEnd</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">symbol</span>        <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">single_symbol</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">symbol_name</span><span class="p">)</span><span class="o">.</span><span class="n">leaveWhitespace</span><span class="p">()</span>

        <span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span>    <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="s2">&quot;&#39;+&quot;</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">c_over_c</span>      <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_char_over_chars</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">accent</span>        <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">oneOf</span><span class="p">([</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_accent_map</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_wide_accents</span><span class="p">])</span>
            <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">placeable</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">function</span>      <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_function_names</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">start_group</span>    <span class="o">&lt;&lt;=</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">latexfont</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>
        <span class="n">p</span><span class="o">.</span><span class="n">end_group</span>      <span class="o">&lt;&lt;=</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">simple_group</span>   <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">OneOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">group</span>          <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">start_group</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">end_group</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">font</span>          <span class="o">&lt;&lt;=</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span> <span class="o">+</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fontnames</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">latexfont</span>     <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">oneOf</span><span class="p">([</span><span class="s1">&#39;math&#39;</span> <span class="o">+</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fontnames</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">frac</span>          <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\frac&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Expected \frac</span><span class="si">{num}{den}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">dfrac</span>         <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\dfrac&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Expected \dfrac</span><span class="si">{num}{den}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">stackrel</span>      <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\stackrel&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Expected \stackrel</span><span class="si">{num}{den}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">binom</span>         <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\binom&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Expected \binom</span><span class="si">{num}{den}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span>    <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ambi_delim</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">left_delim</span>    <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_left_delim</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim</span>   <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_right_delim</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">right_delim_safe</span> <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">([</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_right_delim</span> <span class="o">-</span> <span class="p">{</span><span class="s1">&#39;}&#39;</span><span class="p">}),</span> <span class="sa">r</span><span class="s1">&#39;\}&#39;</span><span class="p">])</span>

        <span class="n">p</span><span class="o">.</span><span class="n">genfrac</span> <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\genfrac&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">(((</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>
                 <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">left_delim</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                 <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span>
                   <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">right_delim_safe</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                   <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">float_literal</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">simple_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Expected &quot;</span>
                       <span class="sa">r</span><span class="s2">&quot;\genfrac</span><span class="si">{ldelim}{rdelim}{rulesize}{style}{num}{den}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">sqrt</span> <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\sqrt&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">lbracket</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">int_literal</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbracket</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">required_group</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Expected </span><span class="se">\\</span><span class="s2">sqrt</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">overline</span> <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\overline&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">required_group</span> <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Expected </span><span class="se">\\</span><span class="s2">overline</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span> <span class="o">&lt;&lt;=</span> <span class="n">Combine</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">bslash</span> <span class="o">+</span> <span class="n">Regex</span><span class="p">(</span><span class="s2">&quot;[A-Za-z]*&quot;</span><span class="p">))</span>

        <span class="n">p</span><span class="o">.</span><span class="n">operatorname</span> <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\operatorname&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">lbrace</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">simple</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">rbrace</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Expected </span><span class="se">\\</span><span class="s2">operatorname</span><span class="si">{value}</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">placeable</span>     <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">accentprefixed</span>  <span class="c1"># Must be before accent so named symbols that are</span>
                              <span class="c1"># prefixed with an accent name work</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">accent</span>   <span class="c1"># Must be before symbol as all accents are symbols</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">symbol</span>   <span class="c1"># Must be third to catch all named symbols and single</span>
                         <span class="c1"># chars not in a group</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">c_over_c</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">function</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">group</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">frac</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">dfrac</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">stackrel</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">binom</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">genfrac</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">sqrt</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">overline</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">operatorname</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">simple</span>        <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">space</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">customspace</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">font</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">subsuper</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">subsuperop</span>    <span class="o">&lt;&lt;=</span> <span class="n">oneOf</span><span class="p">([</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">])</span>

        <span class="n">p</span><span class="o">.</span><span class="n">subsuper</span>      <span class="o">&lt;&lt;=</span> <span class="n">Group</span><span class="p">(</span>
            <span class="p">(</span><span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">placeable</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">OneOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">subsuperop</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">placeable</span><span class="p">)</span>
             <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span><span class="p">))</span>
            <span class="o">|</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">placeable</span> <span class="o">+</span> <span class="n">Optional</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span><span class="p">))</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">apostrophe</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">token</span>         <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">simple</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span>
            <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">unknown_symbol</span>  <span class="c1"># Must be last</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span>    <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\left&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">left_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Expected a delimiter&quot;</span><span class="p">))</span>
            <span class="o">+</span> <span class="n">Group</span><span class="p">(</span><span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">simple</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">auto_delim</span><span class="p">))</span>
            <span class="o">+</span> <span class="n">Suppress</span><span class="p">(</span><span class="n">Literal</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\right&quot;</span><span class="p">))</span>
            <span class="o">-</span> <span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">right_delim</span> <span class="o">|</span> <span class="n">p</span><span class="o">.</span><span class="n">ambi_delim</span><span class="p">)</span>
               <span class="o">|</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Expected a delimiter&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">math</span>          <span class="o">&lt;&lt;=</span> <span class="n">OneOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">math_string</span>   <span class="o">&lt;&lt;=</span> <span class="n">QuotedString</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">unquoteResults</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">p</span><span class="o">.</span><span class="n">non_math</span>      <span class="o">&lt;&lt;=</span> <span class="n">Regex</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:(?:</span><span class="se">\\</span><span class="s2">[$])|[^$])*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">leaveWhitespace</span><span class="p">()</span>

        <span class="n">p</span><span class="o">.</span><span class="n">main</span>          <span class="o">&lt;&lt;=</span> <span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">non_math</span> <span class="o">+</span> <span class="n">ZeroOrMore</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">math_string</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">non_math</span><span class="p">)</span> <span class="o">+</span> <span class="n">StringEnd</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Set actions</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                    <span class="n">val</span><span class="o">.</span><span class="n">setParseAction</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_math_expression</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">math</span>

<div class="viewcode-block" id="Parser.parse"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">fonts_object</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse expression *s* using the given *fonts_object* for</span>
<span class="sd">        output, at the given *fontsize* and *dpi*.</span>

<span class="sd">        Returns the parse tree of `Node` instances.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">State</span><span class="p">(</span><span class="n">fonts_object</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ParseBaseException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                                        <span class="n">err</span><span class="o">.</span><span class="n">line</span><span class="p">,</span>
                                        <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)]))</span> <span class="kn">from</span> <span class="nn">err</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_expression</span><span class="o">.</span><span class="n">resetCache</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

    <span class="c1"># The state of the parser is maintained in a stack.  Upon</span>
    <span class="c1"># entering and leaving a group { } or math/non-math, the stack</span>
    <span class="c1"># is pushed and popped accordingly.  The current state always</span>
    <span class="c1"># exists in the top element of the stack.</span>
<div class="viewcode-block" id="Parser.State"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.State">[docs]</a>    <span class="k">class</span> <span class="nc">State</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stores the state of the parser.</span>

<span class="sd">        States are pushed and popped from a stack as necessary, and</span>
<span class="sd">        the &quot;current&quot; state is always at the top of the stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">font_output</span><span class="p">,</span> <span class="n">font</span><span class="p">,</span> <span class="n">font_class</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span> <span class="o">=</span> <span class="n">font_output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">font</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span> <span class="o">=</span> <span class="n">font_class</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">=</span> <span class="n">fontsize</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>

<div class="viewcode-block" id="Parser.State.copy"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.State.copy">[docs]</a>        <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Parser</span><span class="o">.</span><span class="n">State</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font_output</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span></div>

        <span class="nd">@property</span>
        <span class="k">def</span> <span class="nf">font</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_font</span>

        <span class="nd">@font</span><span class="o">.</span><span class="n">setter</span>
        <span class="k">def</span> <span class="nf">font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;rm&#39;</span><span class="p">,</span> <span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;bf&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">font_class</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_font</span> <span class="o">=</span> <span class="n">name</span></div>

<div class="viewcode-block" id="Parser.get_state"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the current `State` of the parser.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.pop_state"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.pop_state">[docs]</a>    <span class="k">def</span> <span class="nf">pop_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pop a `State` off of the stack.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

<div class="viewcode-block" id="Parser.push_state"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.push_state">[docs]</a>    <span class="k">def</span> <span class="nf">push_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Push a new `State` onto the stack, copying the current state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span></div>

<div class="viewcode-block" id="Parser.main"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.main">[docs]</a>    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Parser.math_string"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.math_string">[docs]</a>    <span class="k">def</span> <span class="nf">math_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_math_expression</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="Parser.math"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.math">[docs]</a>    <span class="k">def</span> <span class="nf">math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.non_math"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.non_math">[docs]</a>    <span class="k">def</span> <span class="nf">non_math</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\$&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">)</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Char</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">(),</span> <span class="n">math</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span>
        <span class="c1"># We&#39;re going into math now, so set font to &#39;it&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.default&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_make_space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percentage</span><span class="p">):</span>
        <span class="c1"># All spaces are relative to em width</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.default&#39;</span><span class="p">],</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">advance</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_em_width_cache</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">width</span>
        <span class="k">return</span> <span class="n">Kern</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">percentage</span><span class="p">)</span>

    <span class="n">_space_widths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sa">r</span><span class="s1">&#39;\,&#39;</span><span class="p">:</span>         <span class="mf">0.16667</span><span class="p">,</span>   <span class="c1"># 3/18 em = 3 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\thinspace&#39;</span><span class="p">:</span> <span class="mf">0.16667</span><span class="p">,</span>   <span class="c1"># 3/18 em = 3 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\/&#39;</span><span class="p">:</span>         <span class="mf">0.16667</span><span class="p">,</span>   <span class="c1"># 3/18 em = 3 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\&gt;&#39;</span><span class="p">:</span>         <span class="mf">0.22222</span><span class="p">,</span>   <span class="c1"># 4/18 em = 4 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\:&#39;</span><span class="p">:</span>         <span class="mf">0.22222</span><span class="p">,</span>   <span class="c1"># 4/18 em = 4 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\;&#39;</span><span class="p">:</span>         <span class="mf">0.27778</span><span class="p">,</span>   <span class="c1"># 5/18 em = 5 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\ &#39;</span><span class="p">:</span>         <span class="mf">0.33333</span><span class="p">,</span>   <span class="c1"># 6/18 em = 6 mu</span>
        <span class="sa">r</span><span class="s1">&#39;~&#39;</span><span class="p">:</span>          <span class="mf">0.33333</span><span class="p">,</span>   <span class="c1"># 6/18 em = 6 mu, nonbreakable</span>
        <span class="sa">r</span><span class="s1">&#39;\enspace&#39;</span><span class="p">:</span>   <span class="mf">0.5</span><span class="p">,</span>       <span class="c1"># 9/18 em = 9 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\quad&#39;</span><span class="p">:</span>      <span class="mi">1</span><span class="p">,</span>         <span class="c1"># 1 em = 18 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\qquad&#39;</span><span class="p">:</span>     <span class="mi">2</span><span class="p">,</span>         <span class="c1"># 2 em = 36 mu</span>
        <span class="sa">r</span><span class="s1">&#39;\!&#39;</span><span class="p">:</span>         <span class="o">-</span><span class="mf">0.16667</span><span class="p">,</span>  <span class="c1"># -3/18 em = -3 mu</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Parser.space"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.space">[docs]</a>    <span class="k">def</span> <span class="nf">space</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_space_widths</span><span class="p">[</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">box</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.customspace"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.customspace">[docs]</a>    <span class="k">def</span> <span class="nf">customspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span></div>

<div class="viewcode-block" id="Parser.symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.symbol">[docs]</a>    <span class="k">def</span> <span class="nf">symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">char</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span>
                                      <span class="s2">&quot;Unknown symbol: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">err</span>

        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_spaced_symbols</span><span class="p">:</span>
            <span class="c1"># iterate until we find previous character, needed for cases</span>
            <span class="c1"># such as ${ -2}$, $ -2$, or $   -2$.</span>
            <span class="n">prev_char</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[:</span><span class="n">loc</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="c1"># Binary operators at start of string should not be spaced</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_binary_operators</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">loc</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">prev_char</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span> <span class="ow">or</span>
                     <span class="n">prev_char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_left_delim</span><span class="p">)):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
                               <span class="n">char</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)],</span>
                              <span class="n">do_kern</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_punctuation_symbols</span><span class="p">:</span>

            <span class="c1"># Do not space commas between brackets</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
                <span class="n">prev_char</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[:</span><span class="n">loc</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">next_char</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prev_char</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span> <span class="ow">and</span> <span class="n">next_char</span> <span class="o">==</span> <span class="s1">&#39;}&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>

            <span class="c1"># Do not space dots as decimal separators</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">loc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">([</span><span class="n">char</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_space</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)],</span> <span class="n">do_kern</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">char</span><span class="p">]</span></div>

    <span class="n">accentprefixed</span> <span class="o">=</span> <span class="n">symbol</span>

<div class="viewcode-block" id="Parser.unknown_symbol"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.unknown_symbol">[docs]</a>    <span class="k">def</span> <span class="nf">unknown_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="s2">&quot;Unknown symbol: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span></div>

    <span class="n">_char_over_chars</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># The first 2 entries in the tuple are (font, char, sizescale) for</span>
        <span class="c1"># the two symbols under and over.  The third element is the space</span>
        <span class="c1"># (in multiples of underline height)</span>
        <span class="sa">r</span><span class="s1">&#39;AA&#39;</span><span class="p">:</span> <span class="p">((</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">circ&#39;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Parser.c_over_c"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.c_over_c">[docs]</a>    <span class="k">def</span> <span class="nf">c_over_c</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">under_desc</span><span class="p">,</span> <span class="n">over_desc</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_char_over_chars</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">under_desc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">&quot;Error parsing symbol&quot;</span><span class="p">)</span>

        <span class="n">over_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">over_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">over_state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">over_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">over_state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">over_desc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">over</span> <span class="o">=</span> <span class="n">Accent</span><span class="p">(</span><span class="n">over_desc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">over_state</span><span class="p">)</span>

        <span class="n">under_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">under_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">under_state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">under_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">under_state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*=</span> <span class="n">under_desc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">under</span> <span class="o">=</span> <span class="n">Char</span><span class="p">(</span><span class="n">under_desc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">under_state</span><span class="p">)</span>

        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">over</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">under</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

        <span class="n">over_centered</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">over</span><span class="p">])</span>
        <span class="n">over_centered</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>

        <span class="n">under_centered</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">under</span><span class="p">])</span>
        <span class="n">under_centered</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Vlist</span><span class="p">([</span>
                <span class="n">over_centered</span><span class="p">,</span>
                <span class="n">Vbox</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="n">space</span><span class="p">),</span>
                <span class="n">under_centered</span>
                <span class="p">])</span></div>

    <span class="n">_accent_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sa">r</span><span class="s1">&#39;hat&#39;</span><span class="p">:</span>            <span class="sa">r</span><span class="s1">&#39;\circumflexaccent&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;breve&#39;</span><span class="p">:</span>          <span class="sa">r</span><span class="s1">&#39;\combiningbreve&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;bar&#39;</span><span class="p">:</span>            <span class="sa">r</span><span class="s1">&#39;\combiningoverline&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;grave&#39;</span><span class="p">:</span>          <span class="sa">r</span><span class="s1">&#39;\combininggraveaccent&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;acute&#39;</span><span class="p">:</span>          <span class="sa">r</span><span class="s1">&#39;\combiningacuteaccent&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;tilde&#39;</span><span class="p">:</span>          <span class="sa">r</span><span class="s1">&#39;\combiningtilde&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;dot&#39;</span><span class="p">:</span>            <span class="sa">r</span><span class="s1">&#39;\combiningdotabove&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;ddot&#39;</span><span class="p">:</span>           <span class="sa">r</span><span class="s1">&#39;\combiningdiaeresis&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;vec&#39;</span><span class="p">:</span>            <span class="sa">r</span><span class="s1">&#39;\combiningrightarrowabove&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;\combiningdiaeresis&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;`&quot;</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;\combininggraveaccent&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s2">&quot;&#39;&quot;</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;\combiningacuteaccent&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;~&#39;</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;\combiningtilde&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;.&#39;</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;\combiningdotabove&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;^&#39;</span><span class="p">:</span>              <span class="sa">r</span><span class="s1">&#39;\circumflexaccent&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;overrightarrow&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;\rightarrow&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;overleftarrow&#39;</span><span class="p">:</span>  <span class="sa">r</span><span class="s1">&#39;\leftarrow&#39;</span><span class="p">,</span>
        <span class="sa">r</span><span class="s1">&#39;mathring&#39;</span><span class="p">:</span>       <span class="sa">r</span><span class="s1">&#39;\circ&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">_wide_accents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;widehat widetilde widebar&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

    <span class="c1"># make a lambda and call it to get the namespace right</span>
    <span class="n">_accentprefixed</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">am</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">tex2uni</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">p</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">am</span><span class="p">)</span>
    <span class="p">])(</span><span class="nb">set</span><span class="p">(</span><span class="n">_accent_map</span><span class="p">))</span>

<div class="viewcode-block" id="Parser.accent"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.accent">[docs]</a>    <span class="k">def</span> <span class="nf">accent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">&quot;Error parsing accent&quot;</span><span class="p">)</span>
        <span class="n">accent</span><span class="p">,</span> <span class="n">sym</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">accent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wide_accents</span><span class="p">:</span>
            <span class="n">accent_box</span> <span class="o">=</span> <span class="n">AutoWidthChar</span><span class="p">(</span>
                <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">accent</span><span class="p">,</span> <span class="n">sym</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">char_class</span><span class="o">=</span><span class="n">Accent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">accent_box</span> <span class="o">=</span> <span class="n">Accent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_accent_map</span><span class="p">[</span><span class="n">accent</span><span class="p">],</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">accent</span> <span class="o">==</span> <span class="s1">&#39;mathring&#39;</span><span class="p">:</span>
            <span class="n">accent_box</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="n">accent_box</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
        <span class="n">centered</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">Hbox</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">),</span> <span class="n">accent_box</span><span class="p">])</span>
        <span class="n">centered</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vlist</span><span class="p">([</span>
                <span class="n">centered</span><span class="p">,</span>
                <span class="n">Vbox</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>
                <span class="n">Hlist</span><span class="p">([</span><span class="n">sym</span><span class="p">])</span>
                <span class="p">])</span></div>

<div class="viewcode-block" id="Parser.function"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.function">[docs]</a>    <span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="s1">&#39;rm&#39;</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Char</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="n">hlist</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">hlist</span></div>

<div class="viewcode-block" id="Parser.operatorname"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.operatorname">[docs]</a>    <span class="k">def</span> <span class="nf">operatorname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="s1">&#39;rm&#39;</span>
        <span class="c1"># Change the font of Chars, but leave Kerns alone</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="s1">&#39;rm&#39;</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_update_metrics</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Parser.start_group"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.start_group">[docs]</a>    <span class="k">def</span> <span class="nf">start_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_state</span><span class="p">()</span>
        <span class="c1"># Deal with LaTeX-style font tokens</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Parser.group"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.group">[docs]</a>    <span class="k">def</span> <span class="nf">group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">grp</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">grp</span><span class="p">]</span></div>
    <span class="n">required_group</span> <span class="o">=</span> <span class="n">simple_group</span> <span class="o">=</span> <span class="n">group</span>

<div class="viewcode-block" id="Parser.end_group"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.end_group">[docs]</a>    <span class="k">def</span> <span class="nf">end_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_state</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Parser.font"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.font">[docs]</a>    <span class="k">def</span> <span class="nf">font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">return</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="Parser.is_overunder"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_overunder">[docs]</a>    <span class="k">def</span> <span class="nf">is_overunder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleus</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overunder_symbols</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="s1">&#39;function_name&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">function_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_overunder_functions</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.is_dropsub"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_dropsub">[docs]</a>    <span class="k">def</span> <span class="nf">is_dropsub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleus</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dropsub_symbols</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.is_slanted"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_slanted">[docs]</a>    <span class="k">def</span> <span class="nf">is_slanted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleus</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">is_slanted</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.is_between_brackets"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.is_between_brackets">[docs]</a>    <span class="k">def</span> <span class="nf">is_between_brackets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Parser.subsuper"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.subsuper">[docs]</a>    <span class="k">def</span> <span class="nf">subsuper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="n">nucleus</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Pick all of the apostrophes out, including first apostrophes that</span>
        <span class="c1"># have been parsed as characters</span>
        <span class="n">napostrophes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">new_toks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">tok</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tok</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="n">napostrophes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tok</span><span class="p">,</span> <span class="n">Char</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tok</span><span class="o">.</span><span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">:</span>
                <span class="n">napostrophes</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_toks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tok</span><span class="p">)</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="n">new_toks</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">napostrophes</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">Hbox</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">napostrophes</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># .asList()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nucleus</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
            <span class="c1"># single subscript or superscript</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="n">Hbox</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">op</span><span class="p">,</span> <span class="nb">next</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">op</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="nb">next</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="nb">next</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="c1"># subscript and superscript</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span> <span class="k">else</span> <span class="n">Hbox</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">op1</span><span class="p">,</span> <span class="n">next1</span><span class="p">,</span> <span class="n">op2</span><span class="p">,</span> <span class="n">next2</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">op1</span> <span class="o">==</span> <span class="n">op2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">op1</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">&quot;Double subscript&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span><span class="s2">&quot;Double superscript&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">op1</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="n">next1</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="n">next2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="n">next1</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="n">next2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ParseFatalException</span><span class="p">(</span>
                <span class="s2">&quot;Subscript/superscript sequence is too long. &quot;</span>
                <span class="s2">&quot;Use braces { } to remove ambiguity.&quot;</span><span class="p">)</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">rule_thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">xHeight</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_xheight</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">napostrophes</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">super</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">napostrophes</span><span class="p">):</span>
                <span class="nb">super</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">prime&#39;</span><span class="p">]))</span>
            <span class="c1"># kern() and hpack() needed to get the metrics right after</span>
            <span class="c1"># extending</span>
            <span class="nb">super</span><span class="o">.</span><span class="n">kern</span><span class="p">()</span>
            <span class="nb">super</span><span class="o">.</span><span class="n">hpack</span><span class="p">()</span>

        <span class="c1"># Handle over/under symbols, such as sum or integral</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_overunder</span><span class="p">(</span><span class="n">nucleus</span><span class="p">):</span>
            <span class="n">vlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">shift</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">width</span>
            <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">super</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="nb">super</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">sub</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">sub</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hlist</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="nb">super</span><span class="p">])</span>
                <span class="n">hlist</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>
                <span class="n">vlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">hlist</span><span class="p">,</span> <span class="n">Kern</span><span class="p">(</span><span class="n">rule_thickness</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">)])</span>
            <span class="n">hlist</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">nucleus</span><span class="p">])</span>
            <span class="n">hlist</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>
            <span class="n">vlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hlist</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">hlist</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">sub</span><span class="p">])</span>
                <span class="n">hlist</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>
                <span class="n">vlist</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">rule_thickness</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">),</span> <span class="n">hlist</span><span class="p">])</span>
                <span class="n">shift</span> <span class="o">=</span> <span class="n">hlist</span><span class="o">.</span><span class="n">height</span>
            <span class="n">vlist</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">(</span><span class="n">vlist</span><span class="p">)</span>
            <span class="n">vlist</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift</span> <span class="o">+</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">depth</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">vlist</span><span class="p">])</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span>

        <span class="c1"># We remove kerning on the last character for consistency (otherwise</span>
        <span class="c1"># it will compute kerning based on non-shrunk characters and may put</span>
        <span class="c1"># them too close together when superscripted)</span>
        <span class="c1"># We change the width of the last character to match the advance to</span>
        <span class="c1"># consider some fonts with weird metrics: e.g. stix&#39;s f has a width of</span>
        <span class="c1"># 7.75 and a kerning of -4.0 for an advance of 3.72, and we want to put</span>
        <span class="c1"># the superscript at the advance</span>
        <span class="n">last_char</span> <span class="o">=</span> <span class="n">nucleus</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Hlist</span><span class="p">):</span>
            <span class="n">new_children</span> <span class="o">=</span> <span class="n">nucleus</span><span class="o">.</span><span class="n">children</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_children</span><span class="p">):</span>
                <span class="c1"># remove last kern</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">new_children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Kern</span><span class="p">)</span> <span class="ow">and</span>
                        <span class="nb">hasattr</span><span class="p">(</span><span class="n">new_children</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;_metrics&#39;</span><span class="p">)):</span>
                    <span class="n">new_children</span> <span class="o">=</span> <span class="n">new_children</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">last_char</span> <span class="o">=</span> <span class="n">new_children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">last_char</span><span class="p">,</span> <span class="s1">&#39;_metrics&#39;</span><span class="p">):</span>
                    <span class="n">last_char</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">advance</span>
            <span class="c1"># create new Hlist without kerning</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">new_children</span><span class="p">,</span> <span class="n">do_kern</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">Char</span><span class="p">):</span>
                <span class="n">last_char</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">_metrics</span><span class="o">.</span><span class="n">advance</span>
            <span class="n">nucleus</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">nucleus</span><span class="p">])</span>

        <span class="c1"># Handle regular sub/superscripts</span>
        <span class="n">constants</span> <span class="o">=</span> <span class="n">_get_font_constant_set</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="n">lc_height</span>   <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">height</span>
        <span class="n">lc_baseline</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
            <span class="n">lc_baseline</span> <span class="o">=</span> <span class="n">last_char</span><span class="o">.</span><span class="n">depth</span>

        <span class="c1"># Compute kerning for sub and super</span>
        <span class="n">superkern</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="n">xHeight</span>
        <span class="n">subkern</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="n">xHeight</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_slanted</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
            <span class="n">superkern</span> <span class="o">+=</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="n">superkern</span> <span class="o">+=</span> <span class="p">(</span><span class="n">constants</span><span class="o">.</span><span class="n">delta_slanted</span> <span class="o">*</span>
                          <span class="p">(</span><span class="n">lc_height</span> <span class="o">-</span> <span class="n">xHeight</span> <span class="o">*</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                <span class="n">subkern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">-</span>
                           <span class="n">constants</span><span class="o">.</span><span class="n">delta_integral</span><span class="p">)</span> <span class="o">*</span> <span class="n">lc_height</span>
                <span class="n">superkern</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">constants</span><span class="o">.</span><span class="n">delta</span> <span class="o">+</span>
                             <span class="n">constants</span><span class="o">.</span><span class="n">delta_integral</span><span class="p">)</span> <span class="o">*</span> <span class="n">lc_height</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subkern</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">super</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># node757</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">subkern</span><span class="p">),</span> <span class="n">sub</span><span class="p">])</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                <span class="n">shift_down</span> <span class="o">=</span> <span class="n">lc_baseline</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">subdrop</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shift_down</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sub1</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift_down</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">superkern</span><span class="p">),</span> <span class="nb">super</span><span class="p">])</span>
            <span class="n">x</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                <span class="n">shift_up</span> <span class="o">=</span> <span class="n">lc_height</span> <span class="o">-</span> <span class="n">constants</span><span class="o">.</span><span class="n">subdrop</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">shift_up</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sup1</span> <span class="o">*</span> <span class="n">xHeight</span>
            <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="o">-</span><span class="n">shift_up</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># Both sub and superscript</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Kern</span><span class="p">(</span><span class="n">subkern</span><span class="p">),</span> <span class="n">sub</span><span class="p">])</span>
                <span class="n">y</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
                    <span class="n">shift_down</span> <span class="o">=</span> <span class="n">lc_baseline</span> <span class="o">+</span> <span class="n">constants</span><span class="o">.</span><span class="n">subdrop</span> <span class="o">*</span> <span class="n">xHeight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shift_down</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">sub2</span> <span class="o">*</span> <span class="n">xHeight</span>
                <span class="c1"># If sub and superscript collide, move super up</span>
                <span class="n">clr</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">rule_thickness</span> <span class="o">-</span>
                       <span class="p">((</span><span class="n">shift_up</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">shift_down</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">clr</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                    <span class="n">shift_up</span> <span class="o">+=</span> <span class="n">clr</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">Kern</span><span class="p">((</span><span class="n">shift_up</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">shift_down</span><span class="p">)),</span>
                    <span class="n">y</span><span class="p">])</span>
                <span class="n">x</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift_down</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_dropsub</span><span class="p">(</span><span class="n">last_char</span><span class="p">):</span>
            <span class="n">x</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="n">constants</span><span class="o">.</span><span class="n">script_space</span> <span class="o">*</span> <span class="n">xHeight</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">nucleus</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">result</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_genfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ldelim</span><span class="p">,</span> <span class="n">rdelim</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">rule</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

        <span class="c1"># If style != displaystyle == 0, shrink the num and den</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">&#39;displaystyle&#39;</span><span class="p">]:</span>
            <span class="n">num</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="n">den</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
        <span class="n">cnum</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">num</span><span class="p">])</span>
        <span class="n">cden</span> <span class="o">=</span> <span class="n">HCentered</span><span class="p">([</span><span class="n">den</span><span class="p">])</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">den</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">cnum</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>
        <span class="n">cden</span><span class="o">.</span><span class="n">hpack</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s1">&#39;exactly&#39;</span><span class="p">)</span>
        <span class="n">vlist</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">cnum</span><span class="p">,</span>                      <span class="c1"># numerator</span>
                       <span class="n">Vbox</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># space</span>
                       <span class="n">Hrule</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">rule</span><span class="p">),</span>        <span class="c1"># rule</span>
                       <span class="n">Vbox</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">),</span>  <span class="c1"># space</span>
                       <span class="n">cden</span>                       <span class="c1"># denominator</span>
                       <span class="p">])</span>

        <span class="c1"># Shift so the fraction line sits in the middle of the</span>
        <span class="c1"># equals sign</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_metrics</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.default&#39;</span><span class="p">],</span>
            <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="p">(</span><span class="n">cden</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span>
                 <span class="p">((</span><span class="n">metrics</span><span class="o">.</span><span class="n">ymax</span> <span class="o">+</span> <span class="n">metrics</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span>
                  <span class="n">thickness</span> <span class="o">*</span> <span class="mf">3.0</span><span class="p">))</span>
        <span class="n">vlist</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="n">shift</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">Hlist</span><span class="p">([</span><span class="n">vlist</span><span class="p">,</span> <span class="n">Hbox</span><span class="p">(</span><span class="n">thickness</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">)])]</span>
        <span class="k">if</span> <span class="n">ldelim</span> <span class="ow">or</span> <span class="n">rdelim</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ldelim</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">ldelim</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
            <span class="k">if</span> <span class="n">rdelim</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">rdelim</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_sized_delimiter</span><span class="p">(</span><span class="n">ldelim</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">rdelim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Parser.genfrac"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.genfrac">[docs]</a>    <span class="k">def</span> <span class="nf">genfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">6</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="o">*</span><span class="nb">tuple</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Parser.frac"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.frac">[docs]</a>    <span class="k">def</span> <span class="nf">frac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">&#39;textstyle&#39;</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.dfrac"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.dfrac">[docs]</a>    <span class="k">def</span> <span class="nf">dfrac</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">&#39;displaystyle&#39;</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.binom"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.binom">[docs]</a>    <span class="k">def</span> <span class="nf">binom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">den</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_genfrac</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_math_style_dict</span><span class="p">[</span><span class="s1">&#39;textstyle&#39;</span><span class="p">],</span> <span class="n">num</span><span class="p">,</span> <span class="n">den</span><span class="p">)</span></div>

<div class="viewcode-block" id="Parser.sqrt"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.sqrt">[docs]</a>    <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="c1"># Determine the height of the body, and add a little extra to</span>
        <span class="c1"># the height so it doesn&#39;t seem cramped</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">+</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">5.0</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span>
        <span class="n">check</span> <span class="o">=</span> <span class="n">AutoHeightChar</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\__sqrt__&#39;</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">check</span><span class="o">.</span><span class="n">shift_amount</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">check</span><span class="o">.</span><span class="n">shift_amount</span>

        <span class="c1"># Put a little extra space to the left and right of the body</span>
        <span class="n">padded_body</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Hbox</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">thickness</span><span class="p">),</span> <span class="n">body</span><span class="p">,</span> <span class="n">Hbox</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">thickness</span><span class="p">)])</span>
        <span class="n">rightside</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">Hrule</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">Glue</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">),</span> <span class="n">padded_body</span><span class="p">])</span>
        <span class="c1"># Stretch the glue between the hrule and the body</span>
        <span class="n">rightside</span><span class="o">.</span><span class="n">vpack</span><span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="mf">12.0</span><span class="p">),</span>
                        <span class="s1">&#39;exactly&#39;</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="c1"># Add the root and shift it upward so it is above the tick.</span>
        <span class="c1"># The value of 0.6 is a hard-coded hack ;)</span>
        <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">check</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">root</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">Char</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">root</span><span class="p">])</span>
            <span class="n">root</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>
            <span class="n">root</span><span class="o">.</span><span class="n">shrink</span><span class="p">()</span>

        <span class="n">root_vlist</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">Hlist</span><span class="p">([</span><span class="n">root</span><span class="p">])])</span>
        <span class="n">root_vlist</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">=</span> <span class="o">-</span><span class="n">height</span> <span class="o">*</span> <span class="mf">0.6</span>

        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">root_vlist</span><span class="p">,</span>               <span class="c1"># Root</span>
                       <span class="c1"># Negative kerning to put root over tick</span>
                       <span class="n">Kern</span><span class="p">(</span><span class="o">-</span><span class="n">check</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">),</span>
                       <span class="n">check</span><span class="p">,</span>                    <span class="c1"># Check</span>
                       <span class="n">rightside</span><span class="p">])</span>               <span class="c1"># Body</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

<div class="viewcode-block" id="Parser.overline"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.overline">[docs]</a>    <span class="k">def</span> <span class="nf">overline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span>

        <span class="n">body</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="n">thickness</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">font_output</span><span class="o">.</span><span class="n">get_underline_thickness</span><span class="p">(</span>
            <span class="n">state</span><span class="o">.</span><span class="n">font</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">height</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span> <span class="o">+</span> <span class="n">thickness</span> <span class="o">*</span> <span class="mf">3.0</span>
        <span class="n">depth</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">depth</span> <span class="o">+</span> <span class="n">body</span><span class="o">.</span><span class="n">shift_amount</span>

        <span class="c1"># Place overline above body</span>
        <span class="n">rightside</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">([</span><span class="n">Hrule</span><span class="p">(</span><span class="n">state</span><span class="p">),</span> <span class="n">Glue</span><span class="p">(</span><span class="s1">&#39;fill&#39;</span><span class="p">),</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">body</span><span class="p">])])</span>

        <span class="c1"># Stretch the glue between the hrule and the body</span>
        <span class="n">rightside</span><span class="o">.</span><span class="n">vpack</span><span class="p">(</span><span class="n">height</span> <span class="o">+</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">fontsize</span> <span class="o">*</span> <span class="n">state</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="mf">12.0</span><span class="p">),</span>
                        <span class="s1">&#39;exactly&#39;</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span>

        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">([</span><span class="n">rightside</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">hlist</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="nf">_auto_sized_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">front</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">back</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">middle</span><span class="p">):</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">height</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle</span><span class="p">)</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">depth</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">middle</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># \left. and \right. aren&#39;t supposed to produce any symbols</span>
        <span class="k">if</span> <span class="n">front</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AutoHeightChar</span><span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">))</span>
        <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">middle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">back</span> <span class="o">!=</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AutoHeightChar</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">factor</span><span class="p">))</span>
        <span class="n">hlist</span> <span class="o">=</span> <span class="n">Hlist</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">hlist</span>

<div class="viewcode-block" id="Parser.auto_delim"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.Parser.auto_delim">[docs]</a>    <span class="k">def</span> <span class="nf">auto_delim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">toks</span><span class="p">):</span>
        <span class="n">front</span><span class="p">,</span> <span class="n">middle</span><span class="p">,</span> <span class="n">back</span> <span class="o">=</span> <span class="n">toks</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_sized_delimiter</span><span class="p">(</span><span class="n">front</span><span class="p">,</span> <span class="n">middle</span><span class="o">.</span><span class="n">asList</span><span class="p">(),</span> <span class="n">back</span><span class="p">)</span></div></div>


<span class="c1">##############################################################################</span>
<span class="c1"># MAIN</span>


<div class="viewcode-block" id="MathTextParser"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser">[docs]</a><span class="k">class</span> <span class="nc">MathTextParser</span><span class="p">:</span>
    <span class="n">_parser</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_backend_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;bitmap&#39;</span><span class="p">:</span> <span class="n">MathtextBackendBitmap</span><span class="p">,</span>
        <span class="s1">&#39;agg&#39;</span><span class="p">:</span>    <span class="n">MathtextBackendAgg</span><span class="p">,</span>
        <span class="s1">&#39;ps&#39;</span><span class="p">:</span>     <span class="n">MathtextBackendPs</span><span class="p">,</span>
        <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>    <span class="n">MathtextBackendPdf</span><span class="p">,</span>
        <span class="s1">&#39;svg&#39;</span><span class="p">:</span>    <span class="n">MathtextBackendSvg</span><span class="p">,</span>
        <span class="s1">&#39;path&#39;</span><span class="p">:</span>   <span class="n">MathtextBackendPath</span><span class="p">,</span>
        <span class="s1">&#39;cairo&#39;</span><span class="p">:</span>  <span class="n">MathtextBackendCairo</span><span class="p">,</span>
        <span class="s1">&#39;macosx&#39;</span><span class="p">:</span> <span class="n">MathtextBackendAgg</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">_font_type_mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;cm&#39;</span><span class="p">:</span>          <span class="n">BakomaFonts</span><span class="p">,</span>
        <span class="s1">&#39;dejavuserif&#39;</span><span class="p">:</span> <span class="n">DejaVuSerifFonts</span><span class="p">,</span>
        <span class="s1">&#39;dejavusans&#39;</span><span class="p">:</span>  <span class="n">DejaVuSansFonts</span><span class="p">,</span>
        <span class="s1">&#39;stix&#39;</span><span class="p">:</span>        <span class="n">StixFonts</span><span class="p">,</span>
        <span class="s1">&#39;stixsans&#39;</span><span class="p">:</span>    <span class="n">StixSansFonts</span><span class="p">,</span>
        <span class="s1">&#39;custom&#39;</span><span class="p">:</span>      <span class="n">UnicodeFonts</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a MathTextParser for the given backend *output*.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<div class="viewcode-block" id="MathTextParser.parse"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse the given math expression *s* at the given *dpi*.  If *prop* is</span>
<span class="sd">        provided, it is a `.FontProperties` object specifying the &quot;default&quot;</span>
<span class="sd">        font to use in the math expression, used for all non-math text.</span>

<span class="sd">        The results are cached, so multiple calls to `parse`</span>
<span class="sd">        with the same expression should be fast.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># lru_cache can&#39;t decorate parse() directly because the ps.useafm and</span>
        <span class="c1"># mathtext.fontset rcParams also affect the parse (e.g. by affecting</span>
        <span class="c1"># the glyph metrics).</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_cached</span><span class="p">(</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ps.useafm&#39;</span><span class="p">],</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;mathtext.fontset&#39;</span><span class="p">])</span></div>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_parse_cached</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">ps_useafm</span><span class="p">,</span> <span class="n">fontset</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">==</span> <span class="s1">&#39;ps&#39;</span> <span class="ow">and</span> <span class="n">ps_useafm</span><span class="p">:</span>
            <span class="n">font_output</span> <span class="o">=</span> <span class="n">StandardPsFonts</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_backend_mapping</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_output</span><span class="p">]()</span>
            <span class="n">fontset_class</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_check_getitem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_font_type_mapping</span><span class="p">,</span> <span class="n">fontset</span><span class="o">=</span><span class="n">fontset</span><span class="p">)</span>
            <span class="n">font_output</span> <span class="o">=</span> <span class="n">fontset_class</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">backend</span><span class="p">)</span>

        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">()</span>

        <span class="c1"># This is a class variable so we don&#39;t rebuild the parser</span>
        <span class="c1"># with each request.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_parser</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">()</span>

        <span class="n">box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">font_output</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="n">font_output</span><span class="o">.</span><span class="n">set_canvas_size</span><span class="p">(</span><span class="n">box</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">box</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">font_output</span><span class="o">.</span><span class="n">get_results</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

<div class="viewcode-block" id="MathTextParser.to_mask"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.to_mask">[docs]</a>    <span class="k">def</span> <span class="nf">to_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        texstr : str</span>
<span class="sd">            A valid mathtext string, e.g., r&#39;IQ: $\sigma_i=15$&#39;.</span>
<span class="sd">        dpi : float</span>
<span class="sd">            The dots-per-inch setting used to render the text.</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            The font size in points</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array : 2D uint8 alpha</span>
<span class="sd">            Mask array of rasterized tex.</span>
<span class="sd">        depth : int</span>
<span class="sd">            Offset of the baseline from the bottom of the image, in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">==</span> <span class="s2">&quot;bitmap&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ftimage</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ftimage</span><span class="p">),</span> <span class="n">depth</span></div>

<div class="viewcode-block" id="MathTextParser.to_rgba"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.to_rgba">[docs]</a>    <span class="k">def</span> <span class="nf">to_rgba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        texstr : str</span>
<span class="sd">            A valid mathtext string, e.g., r&#39;IQ: $\sigma_i=15$&#39;.</span>
<span class="sd">        color : color</span>
<span class="sd">            The text color.</span>
<span class="sd">        dpi : float</span>
<span class="sd">            The dots-per-inch setting used to render the text.</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            The font size in points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        array : (M, N, 4) array</span>
<span class="sd">            RGBA color values of rasterized tex, colorized with *color*.</span>
<span class="sd">        depth : int</span>
<span class="sd">            Offset of the baseline from the bottom of the image, in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_mask</span><span class="p">(</span><span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

        <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">RGBA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">r</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">g</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">*</span> <span class="n">b</span>
        <span class="n">RGBA</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">RGBA</span><span class="p">,</span> <span class="n">depth</span></div>

<div class="viewcode-block" id="MathTextParser.to_png"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.to_png">[docs]</a>    <span class="k">def</span> <span class="nf">to_png</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render a tex expression to a PNG file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename</span>
<span class="sd">            A writable filename or fileobject.</span>
<span class="sd">        texstr : str</span>
<span class="sd">            A valid mathtext string, e.g., r&#39;IQ: $\sigma_i=15$&#39;.</span>
<span class="sd">        color : color</span>
<span class="sd">            The text color.</span>
<span class="sd">        dpi : float</span>
<span class="sd">            The dots-per-inch setting used to render the text.</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            The font size in points.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Offset of the baseline from the bottom of the image, in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rgba</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span>
            <span class="n">texstr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rgba</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depth</span></div>

<div class="viewcode-block" id="MathTextParser.get_depth"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.MathTextParser.get_depth">[docs]</a>    <span class="k">def</span> <span class="nf">get_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        texstr : str</span>
<span class="sd">            A valid mathtext string, e.g., r&#39;IQ: $\sigma_i=15$&#39;.</span>
<span class="sd">        dpi : float</span>
<span class="sd">            The dots-per-inch setting used to render the text.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Offset of the baseline from the bottom of the image, in pixels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output</span> <span class="o">==</span> <span class="s2">&quot;bitmap&quot;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">ftimage</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">texstr</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depth</span></div></div>


<div class="viewcode-block" id="math_to_image"><a class="viewcode-back" href="../../api/mathtext_api.html#matplotlib.mathtext.math_to_image">[docs]</a><span class="k">def</span> <span class="nf">math_to_image</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">filename_or_obj</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a math expression, renders it in a closely-clipped bounding</span>
<span class="sd">    box to an image file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : str</span>
<span class="sd">        A math expression.  The math portion must be enclosed in dollar signs.</span>
<span class="sd">    filename_or_obj : str or path-like or file-like</span>
<span class="sd">        Where to write the image data.</span>
<span class="sd">    prop : `.FontProperties`, optional</span>
<span class="sd">        The size and style of the text.</span>
<span class="sd">    dpi : float, optional</span>
<span class="sd">        The output dpi.  If not set, the dpi is determined as for</span>
<span class="sd">        `.Figure.savefig`.</span>
<span class="sd">    format : str, optional</span>
<span class="sd">        The output format, e.g., &#39;svg&#39;, &#39;pdf&#39;, &#39;ps&#39; or &#39;png&#39;.  If not set, the</span>
<span class="sd">        format is determined as for `.Figure.savefig`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">figure</span>
    <span class="c1"># backend_agg supports all of the core output formats</span>
    <span class="kn">from</span> <span class="nn">matplotlib.backends</span> <span class="kn">import</span> <span class="n">backend_agg</span>

    <span class="k">if</span> <span class="n">prop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">FontProperties</span><span class="p">()</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">MathTextParser</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
    <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mf">72.0</span><span class="p">,</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">72.0</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">depth</span><span class="o">/</span><span class="n">height</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">fontproperties</span><span class="o">=</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">backend_agg</span><span class="o">.</span><span class="n">FigureCanvasAgg</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">depth</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<footer>
    <div class="footer">
    &copy; Copyright 2002 - 2012 John Hunter, Darren Dale, Eric Firing, Michael Droettboom and the Matplotlib development team; 2012 - 2020 The Matplotlib development team.
<br />
    Last updated on Jul 12, 2020.
Created using
<a href="http://sphinx-doc.org/">Sphinx</a> 3.1.2.
Doc version v3.3.0rc1-229-g97785f2e6.
    </div>
</footer>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-55954603-1', 'auto');
        ga('send', 'pageview');

</script>
  </body>
</html>